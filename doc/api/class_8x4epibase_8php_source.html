<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>4eyes - Base Class: class.x4epibase.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>class.x4epibase.php</h1>  </div>
</div>
<div class="contents">
<a href="class_8x4epibase_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/***************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">*  Copyright notice</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">*  (c) 2005 Markus Stauffiger (markus@4eyes.ch)</span>
<a name="l00006"></a>00006 <span class="comment">*  All rights reserved</span>
<a name="l00007"></a>00007 <span class="comment">*  This script is part of the TYPO3 project. The TYPO3 project is</span>
<a name="l00008"></a>00008 <span class="comment">*  free software; you can redistribute it and/or modify</span>
<a name="l00009"></a>00009 <span class="comment">*  it under the terms of the GNU General Public License as published by</span>
<a name="l00010"></a>00010 <span class="comment">*  the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00011"></a>00011 <span class="comment">*  (at your option) any later version.</span>
<a name="l00012"></a>00012 <span class="comment">*</span>
<a name="l00013"></a>00013 <span class="comment">*  The GNU General Public License can be found at</span>
<a name="l00014"></a>00014 <span class="comment">*  http://www.gnu.org/copyleft/gpl.html.</span>
<a name="l00015"></a>00015 <span class="comment">*</span>
<a name="l00016"></a>00016 <span class="comment">*  This script is distributed in the hope that it will be useful,</span>
<a name="l00017"></a>00017 <span class="comment">*  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00018"></a>00018 <span class="comment">*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00019"></a>00019 <span class="comment">*  GNU General Public License for more details.</span>
<a name="l00020"></a>00020 <span class="comment">*</span>
<a name="l00021"></a>00021 <span class="comment">*  This copyright notice MUST APPEAR in all copies of the script!</span>
<a name="l00022"></a>00022 <span class="comment">***************************************************************/</span>
<a name="l00023"></a>00023 
<a name="l00035"></a>00035 require_once(PATH_tslib.<span class="stringliteral">&#39;class.tslib_pibase.php&#39;</span>);
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classx4epibase.html">00037</a> <span class="keyword">class </span><a class="code" href="classx4epibase.html">x4epibase</a> <span class="keyword">extends</span> tslib_pibase {
<a name="l00043"></a><a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">00043</a>         var <a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>;
<a name="l00044"></a>00044 
<a name="l00050"></a><a class="code" href="classx4epibase.html#a13ad46a2554a4e23412d2493485a56b0">00050</a>         var <a class="code" href="classx4epibase.html#a13ad46a2554a4e23412d2493485a56b0">$categoryTable</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00051"></a>00051 
<a name="l00057"></a><a class="code" href="classx4epibase.html#adedadbed43cf954c41e708859bfb5c15">00057</a>         var <a class="code" href="classx4epibase.html#adedadbed43cf954c41e708859bfb5c15">$categoryField</a> = <span class="stringliteral">&#39;category_id&#39;</span>;
<a name="l00058"></a>00058 
<a name="l00062"></a><a class="code" href="classx4epibase.html#a9fd3b527976aa902a9026caded031237">00062</a>         var <a class="code" href="classx4epibase.html#a9fd3b527976aa902a9026caded031237">$categoryLabelField</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00063"></a>00063 
<a name="l00067"></a><a class="code" href="classx4epibase.html#a49c23c9fda7c3805b853b50d86ab1f4a">00067</a>         var <a class="code" href="classx4epibase.html#a49c23c9fda7c3805b853b50d86ab1f4a">$categorySortField</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00068"></a>00068 
<a name="l00072"></a><a class="code" href="classx4epibase.html#a8664f0186527c6728b28e59f630229de">00072</a>         var <a class="code" href="classx4epibase.html#a8664f0186527c6728b28e59f630229de">$listT</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00073"></a>00073 
<a name="l00077"></a><a class="code" href="classx4epibase.html#a22871bc053b3309e19b63e92893de01a">00077</a>         var <a class="code" href="classx4epibase.html#a22871bc053b3309e19b63e92893de01a">$manualFieldOrder_list</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00078"></a>00078 
<a name="l00084"></a><a class="code" href="classx4epibase.html#abf520f6b3e5c69aaf2e6252bf73f31d6">00084</a>         var <a class="code" href="classx4epibase.html#abf520f6b3e5c69aaf2e6252bf73f31d6">$currentCategory</a> = array();
<a name="l00085"></a>00085 
<a name="l00092"></a><a class="code" href="classx4epibase.html#a390e012ab8150b45bc82ec86c50c0689">00092</a>         var <a class="code" href="classx4epibase.html#a390e012ab8150b45bc82ec86c50c0689">$skipHtmlEntitiesFields</a> = array();
<a name="l00093"></a>00093 
<a name="l00099"></a><a class="code" href="classx4epibase.html#abcdbe54b75d722863feb7ef6597d6a91">00099</a>         var <a class="code" href="classx4epibase.html#abcdbe54b75d722863feb7ef6597d6a91">$relatedRecords</a> = array();
<a name="l00100"></a>00100 
<a name="l00106"></a><a class="code" href="classx4epibase.html#a91222e78af88e683e8767de40816d875">00106</a>         var <a class="code" href="classx4epibase.html#a91222e78af88e683e8767de40816d875">$prefixId</a> = <span class="stringliteral">&#39;tx_x4epibase_pi1&#39;</span>;             <span class="comment">// Same as class name</span>
<a name="l00107"></a><a class="code" href="classx4epibase.html#ad25a35de6f7b377a56003e6eb8c623c3">00107</a>         var <a class="code" href="classx4epibase.html#ad25a35de6f7b377a56003e6eb8c623c3">$scriptRelPath</a> = <span class="stringliteral">&#39;pi1/class.tx_x4epibase_pi1.php&#39;</span>;  <span class="comment">// Path to this script relative to the extension dir.</span>
<a name="l00108"></a><a class="code" href="classx4epibase.html#a8b2072768dd44193d3425eeef9a30a40">00108</a>         var <a class="code" href="classx4epibase.html#a8b2072768dd44193d3425eeef9a30a40">$extKey</a> = <span class="stringliteral">&#39;x4epibase&#39;</span>;      <span class="comment">// The extension key.</span>
<a name="l00109"></a><a class="code" href="classx4epibase.html#a529d4cdf6ca753668d089e2573857426">00109</a>         var <a class="code" href="classx4epibase.html#a529d4cdf6ca753668d089e2573857426">$pi_checkCHash</a> = TRUE;
<a name="l00110"></a>00110 
<a name="l00118"></a><a class="code" href="classx4epibase.html#af1f78cb0726fb8d105d38ca0debfff5a">00118</a>         var <a class="code" href="classx4epibase.html#af1f78cb0726fb8d105d38ca0debfff5a">$mmTemplates</a> = array();
<a name="l00119"></a>00119 
<a name="l00125"></a><a class="code" href="classx4epibase.html#a01a8b83cb4575ea1a96fdba9f94adec4">00125</a>         var <a class="code" href="classx4epibase.html#a01a8b83cb4575ea1a96fdba9f94adec4">$globalMarkerArray</a> = array();
<a name="l00126"></a>00126 
<a name="l00136"></a><a class="code" href="classx4epibase.html#a3ff843d55b21dfe00d42399c121a75cf">00136</a>         function <a class="code" href="classx4epibase.html#a3ff843d55b21dfe00d42399c121a75cf">init</a>($content,$conf, $overrideTableName = <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00137"></a>00137                 global $TCA;
<a name="l00138"></a>00138                 <span class="comment">// standard typo3 settings</span>
<a name="l00139"></a>00139                 $this-&gt;conf = $conf;
<a name="l00140"></a>00140                 $this-&gt;pi_setPiVarDefaults();
<a name="l00141"></a>00141                 $this-&gt;pi_loadLL();
<a name="l00142"></a>00142                 $this-&gt;pi_initPIflexForm();
<a name="l00143"></a>00143                 
<a name="l00144"></a>00144                 <span class="comment">// overriding default table name</span>
<a name="l00145"></a>00145                 <span class="keywordflow">if</span>($overrideTableName == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00146"></a>00146                         $this-&gt;<a class="code" href="classx4epibase.html#a6b61f62e24987bea2ca4744c7d3497ed">setMemberVariableTSFF</a>(<span class="stringliteral">&#39;tableName&#39;</span>);
<a name="l00147"></a>00147                 } <span class="keywordflow">else</span> {
<a name="l00148"></a>00148                         $this-&gt;tableName = $overrideTableName;
<a name="l00149"></a>00149                 }
<a name="l00150"></a>00150                 
<a name="l00151"></a>00151                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;searchFieldList&#39;</span>] = $this-&gt;conf[<span class="stringliteral">&#39;searchFieldList&#39;</span>];
<a name="l00152"></a>00152 
<a name="l00153"></a>00153                 <span class="comment">// set db-variables</span>
<a name="l00154"></a>00154                 <span class="keywordflow">if</span> (isset($this-&gt;conf[<span class="stringliteral">&#39;orderByList&#39;</span>]) &amp;&amp; ($this-&gt;conf[<span class="stringliteral">&#39;orderByList&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>)) {
<a name="l00155"></a>00155                         $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderByList&#39;</span>] = implode(<span class="charliteral">&#39;,&#39;</span>,t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;orderByList&#39;</span>], 1));
<a name="l00156"></a>00156                 } <span class="keywordflow">else</span> {
<a name="l00157"></a>00157                         $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderByList&#39;</span>] = $this-&gt;conf[<span class="stringliteral">&#39;searchFieldList&#39;</span>];
<a name="l00158"></a>00158                 }
<a name="l00159"></a>00159                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;descFlag&#39;</span>] = $this-&gt;conf[<span class="stringliteral">&#39;orderDesc&#39;</span>];
<a name="l00160"></a>00160                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentTable&#39;</span>] = $this-&gt;tableName;
<a name="l00161"></a>00161                 
<a name="l00162"></a>00162                 <span class="comment">// set fields to display in listview</span>
<a name="l00163"></a>00163                 $this-&gt;manualFieldOrder_list = t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;field_orderList&#39;</span>),1);
<a name="l00164"></a>00164                 
<a name="l00165"></a>00165                 <span class="comment">// use default label-column, if field-list is empty</span>
<a name="l00166"></a>00166                 <span class="keywordflow">if</span>(count($this-&gt;manualFieldOrder_list) == 0) {
<a name="l00167"></a>00167                         $this-&gt;manualFieldOrder_list[0] = $TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>];
<a name="l00168"></a>00168                 }
<a name="l00169"></a>00169                 $this-&gt;conf[<span class="stringliteral">&#39;recursive&#39;</span>] = 0;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171                 <span class="comment">// set pid list (pages with records)</span>
<a name="l00172"></a>00172                 $this-&gt;conf[<span class="stringliteral">&#39;pidList&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;pidList&#39;</span>);
<a name="l00173"></a>00173                 <span class="comment">// use current page as pid if no pidList available</span>
<a name="l00174"></a>00174                 <span class="keywordflow">if</span> ($this-&gt;conf[<span class="stringliteral">&#39;pidList&#39;</span>] == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00175"></a>00175                         $this-&gt;conf[<span class="stringliteral">&#39;pidList&#39;</span>] = $GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;id;
<a name="l00176"></a>00176                 }
<a name="l00177"></a>00177                 
<a name="l00178"></a>00178                 $this-&gt;skipHtmlEntitiesFields = t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;skipHtmlEntitiesFields&#39;</span>],1);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180                 t3lib_div::loadTCA($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentTable&#39;</span>]);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182                 <span class="comment">// put the link-fields in appropriate array</span>
<a name="l00183"></a>00183                 <span class="keywordflow">if</span> (!is_array($this-&gt;conf[<span class="stringliteral">&#39;utf8DecodeFields&#39;</span>])) {
<a name="l00184"></a>00184                         $this-&gt;conf[<span class="stringliteral">&#39;utf8DecodeFields&#39;</span>] = t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;utf8DecodeFields&#39;</span>],1);
<a name="l00185"></a>00185                 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                 <span class="comment">// put the mandatory-fields in appropriate array</span>
<a name="l00188"></a>00188                 <span class="keywordflow">if</span> (isset($this-&gt;conf[<span class="stringliteral">&#39;create.&#39;</span>][<span class="stringliteral">&#39;mandatoryFields&#39;</span>])) {
<a name="l00189"></a>00189                         $this-&gt;conf[<span class="stringliteral">&#39;create.&#39;</span>][<span class="stringliteral">&#39;mandatoryFields&#39;</span>] = t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;create.&#39;</span>][<span class="stringliteral">&#39;mandatoryFields&#39;</span>],1);
<a name="l00190"></a>00190                 }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192                 <span class="comment">// put the link-fields in appropriate array</span>
<a name="l00193"></a>00193                 <span class="keywordflow">if</span> (!is_array($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;detailLinkFields&#39;</span>])) {
<a name="l00194"></a>00194                         $this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;detailLinkFields&#39;</span>] = t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;detailLinkFields&#39;</span>],1);
<a name="l00195"></a>00195                 }
<a name="l00196"></a>00196         }
<a name="l00197"></a>00197 
<a name="l00206"></a><a class="code" href="classx4epibase.html#aa83af860e9370bc59ff0c8c45d914ab6">00206</a>         function <a class="code" href="classx4epibase.html#aa83af860e9370bc59ff0c8c45d914ab6">main</a>($content,$conf){
<a name="l00207"></a>00207                 $this-&gt;<a class="code" href="classx4epibase.html#a3ff843d55b21dfe00d42399c121a75cf">init</a>($content,$conf);
<a name="l00208"></a>00208                 $content = $this-&gt;<a class="code" href="classx4epibase.html#a50677812ea3f0258f7d03bbac5265413">getView</a>();
<a name="l00209"></a>00209                 
<a name="l00210"></a>00210                 <span class="comment">// trigger baseClass-Wrap via TS</span>
<a name="l00211"></a>00211                 <span class="keywordflow">if</span>(intval($this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;noWrapInBaseClass&#39;</span>)) != 1){
<a name="l00212"></a>00212                         <span class="keywordflow">return</span> $this-&gt;pi_wrapInBaseClass($content);
<a name="l00213"></a>00213                 } <span class="keywordflow">else</span> {
<a name="l00214"></a>00214                         <span class="keywordflow">return</span> $content;
<a name="l00215"></a>00215                 }
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217 
<a name="l00224"></a><a class="code" href="classx4epibase.html#ae9accfd914a2505a740b6df86f4d8567">00224</a>         function <a class="code" href="classx4epibase.html#ae9accfd914a2505a740b6df86f4d8567">getOrderByList</a>() {
<a name="l00225"></a>00225                 <span class="keywordflow">if</span> (($this-&gt;conf[<span class="stringliteral">&#39;orderFieldList&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) &amp;&amp; (substr($this-&gt;conf[<span class="stringliteral">&#39;orderFieldList&#39;</span>],0,2) != <span class="stringliteral">&#39;{$&#39;</span>)) {
<a name="l00226"></a>00226                         <span class="keywordflow">return</span> $this-&gt;conf[<span class="stringliteral">&#39;orderByFieldList&#39;</span>];
<a name="l00227"></a>00227                 } <span class="keywordflow">else</span> {
<a name="l00228"></a>00228                         global $TCA;
<a name="l00229"></a>00229                         <span class="keywordflow">if</span> (isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;sorting&#39;</span>])) {
<a name="l00230"></a>00230                                 <span class="keywordflow">return</span> $TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;sorting&#39;</span>];
<a name="l00231"></a>00231                         } <span class="keywordflow">else</span> {
<a name="l00232"></a>00232                                 <span class="keywordflow">return</span> $TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;default_sortby&#39;</span>];
<a name="l00233"></a>00233                         }
<a name="l00234"></a>00234                 }
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236 
<a name="l00244"></a><a class="code" href="classx4epibase.html#a6b61f62e24987bea2ca4744c7d3497ed">00244</a>         function <a class="code" href="classx4epibase.html#a6b61f62e24987bea2ca4744c7d3497ed">setMemberVariableTSFF</a>($name) {
<a name="l00245"></a>00245                 $value = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>($name);
<a name="l00246"></a>00246                 <span class="keywordflow">if</span> ($value != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00247"></a>00247                         $this-&gt;$name = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>($name);
<a name="l00248"></a>00248                 }
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250 
<a name="l00256"></a><a class="code" href="classx4epibase.html#a50677812ea3f0258f7d03bbac5265413">00256</a>         function <a class="code" href="classx4epibase.html#a50677812ea3f0258f7d03bbac5265413">getView</a>() {
<a name="l00257"></a>00257                 <span class="keywordflow">if</span> ($this-&gt;piVars[<span class="stringliteral">&#39;showUid&#39;</span>]) {
<a name="l00258"></a>00258                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#a01e521ebe17734a191faad2124b10760">singleView</a>();
<a name="l00259"></a>00259                 } <span class="keywordflow">else</span> {
<a name="l00260"></a>00260                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#a15c58dbac9333cde1fed5d4910c40353">getCorrectListView</a>();
<a name="l00261"></a>00261                 }
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263 
<a name="l00270"></a><a class="code" href="classx4epibase.html#a15c58dbac9333cde1fed5d4910c40353">00270</a>         function <a class="code" href="classx4epibase.html#a15c58dbac9333cde1fed5d4910c40353">getCorrectListView</a>() {
<a name="l00271"></a>00271                 <span class="keywordflow">switch</span>($this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;modeSelection&#39;</span>)) {
<a name="l00272"></a>00272                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;category&#39;</span>:
<a name="l00273"></a>00273                                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#ae4e1ebf4626f92874f3299d18b1d9c5d">listByCategory</a>();
<a name="l00274"></a>00274                         <span class="keywordflow">break</span>;
<a name="l00275"></a>00275                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;categoryMenu&#39;</span>:
<a name="l00276"></a>00276                                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#ac420a00f1d52b2088e1fff0d94f32ad2">getCategoryMenu</a>();
<a name="l00277"></a>00277                         <span class="keywordflow">break</span>;
<a name="l00278"></a>00278                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;listOfDetail&#39;</span>:
<a name="l00279"></a>00279                                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#a9066fd925429222a9633c49a09e1b90a">listOfDetailView</a>();
<a name="l00280"></a>00280                         <span class="keywordflow">break</span>;
<a name="l00281"></a>00281                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;alphabeticalList&#39;</span>:
<a name="l00282"></a>00282                                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#a3db1d1080555f083098284d99c00f12f">listByAlphabet</a>();
<a name="l00283"></a>00283                         <span class="keywordflow">break</span>;
<a name="l00284"></a>00284                         <span class="keywordflow">default</span>:
<a name="l00285"></a>00285                                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#a2d5f4904171be2f41c2d0c09de9ff234">listView</a>();
<a name="l00286"></a>00286                         <span class="keywordflow">break</span>;
<a name="l00287"></a>00287                 }
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289 
<a name="l00296"></a><a class="code" href="classx4epibase.html#ac420a00f1d52b2088e1fff0d94f32ad2">00296</a>         function <a class="code" href="classx4epibase.html#ac420a00f1d52b2088e1fff0d94f32ad2">getCategoryMenu</a>($addWhere=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l00297"></a>00297                 $templateCode = $this-&gt;cObj-&gt;fileResource($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;template&#39;</span>]);
<a name="l00298"></a>00298                 <span class="keywordflow">if</span> ($templateCode == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00299"></a>00299                         $templateCode = $this-&gt;<span class="keyword">template</span>;
<a name="l00300"></a>00300                 }
<a name="l00301"></a>00301                 
<a name="l00302"></a>00302                 $template[<span class="stringliteral">&#39;total&#39;</span>] = $this-&gt;cObj-&gt;getSubpart($templateCode, <span class="stringliteral">&#39;###catMenu###&#39;</span>);
<a name="l00303"></a>00303                 $template[<span class="stringliteral">&#39;menu&#39;</span>] = $this-&gt;cObj-&gt;getSubpart($template[<span class="stringliteral">&#39;total&#39;</span>], <span class="stringliteral">&#39;###menu###&#39;</span>);
<a name="l00304"></a>00304 
<a name="l00305"></a>00305                 <span class="keywordflow">if</span> (isset($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;catTable&#39;</span>])) {
<a name="l00306"></a>00306                         $catTable = $this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;catTable&#39;</span>];
<a name="l00307"></a>00307                 } <span class="keywordflow">else</span> {
<a name="l00308"></a>00308                         $catTable = $this-&gt;categoryTable;
<a name="l00309"></a>00309                 }
<a name="l00310"></a>00310                 <span class="keywordflow">if</span> (isset($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;catField&#39;</span>])) {
<a name="l00311"></a>00311                         $catField = $this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;catField&#39;</span>];
<a name="l00312"></a>00312                 } <span class="keywordflow">else</span> {
<a name="l00313"></a>00313                         $catField = $this-&gt;categoryField;
<a name="l00314"></a>00314                 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316                 <span class="keywordflow">if</span> (isset($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;catLabelField&#39;</span>])) {
<a name="l00317"></a>00317                         $catLabelField = $this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;catLabelField&#39;</span>];
<a name="l00318"></a>00318                 } <span class="keywordflow">else</span> {
<a name="l00319"></a>00319                         $catLabelField = $this-&gt;categoryLabelField;
<a name="l00320"></a>00320                 }
<a name="l00321"></a>00321                 
<a name="l00322"></a>00322                 <span class="keywordflow">if</span>(empty($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;pidList&#39;</span>])){
<a name="l00323"></a>00323                         $this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;pidList&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;categoryPidList&#39;</span>);
<a name="l00324"></a>00324                         <span class="keywordflow">if</span>(empty($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;pidList&#39;</span>])){
<a name="l00325"></a>00325                                 $this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;pidList&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;pidList&#39;</span>);
<a name="l00326"></a>00326                         }
<a name="l00327"></a>00327                 }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329                 <span class="comment">// hide categories with no records</span>
<a name="l00330"></a>00330                 <span class="keywordflow">if</span>($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;onlyShowNecessaryCats&#39;</span>] == <span class="charliteral">&#39;1&#39;</span>) {
<a name="l00331"></a>00331                         $catArr = array();
<a name="l00332"></a>00332                         $projects = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECTquery(<span class="stringliteral">&#39;uid,&#39;</span>.$catField, $this-&gt;tableName, <span class="stringliteral">&#39;1 &#39;</span>.$this-&gt;cObj-&gt;enableFields($this-&gt;tableName));
<a name="l00333"></a>00333                         <span class="keywordflow">while</span>($p = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_assoc($projects)) {
<a name="l00334"></a>00334                                 array_push($catArr, $p[$catField]);
<a name="l00335"></a>00335                         }
<a name="l00336"></a>00336                         $catArr = array_unique($catArr);
<a name="l00337"></a>00337                         $WHERE = <span class="stringliteral">&#39;uid IN (&#39;</span>.implode(<span class="charliteral">&#39;,&#39;</span>,$catArr).<span class="charliteral">&#39;)&#39;</span>;
<a name="l00338"></a>00338                 } <span class="keywordflow">else</span> {
<a name="l00339"></a>00339                         $WHERE = <span class="charliteral">&#39;1&#39;</span>;
<a name="l00340"></a>00340                 }
<a name="l00341"></a>00341                 global $TCA;
<a name="l00342"></a>00342                 t3lib_div::loadTCA($catTable);
<a name="l00343"></a>00343                 <span class="keywordflow">if</span> (isset($TCA[$catTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;languageField&#39;</span>])) {
<a name="l00344"></a>00344                         $WHERE .= <span class="stringliteral">&#39; AND sys_language_uid = 0&#39;</span>;
<a name="l00345"></a>00345                 }
<a name="l00346"></a>00346                 
<a name="l00347"></a>00347                 $WHERE .= <span class="stringliteral">&#39; AND &#39;</span>.$catTable.<span class="stringliteral">&#39;.pid IN (&#39;</span>.$this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;pidList&#39;</span>].<span class="charliteral">&#39;)&#39;</span>.$this-&gt;cObj-&gt;enableFields($catTable);
<a name="l00348"></a>00348                 
<a name="l00349"></a>00349                 $WHERE .= $addWhere;
<a name="l00350"></a>00350                 
<a name="l00351"></a>00351                 $this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;orderCatBy&#39;</span>] ? $ORDERBY = $this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;orderCatBy&#39;</span>] : $this-&gt;categorySortField;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                 $altPageUid = intval($this-&gt;conf[<span class="stringliteral">&#39;categoryMenu.&#39;</span>][<span class="stringliteral">&#39;altPageUid&#39;</span>]);
<a name="l00354"></a>00354                 $cats = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECTquery(<span class="charliteral">&#39;*&#39;</span>, $catTable, $WHERE, <span class="stringliteral">&#39;&#39;</span>, $ORDERBY);
<a name="l00355"></a>00355                 $bakTable = $this-&gt;tableName;
<a name="l00356"></a>00356                 $this-&gt;tableName = $catTable;
<a name="l00357"></a>00357                 <span class="keywordflow">while</span>($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>] = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_assoc($cats)) {
<a name="l00358"></a>00358                         $this-&gt;<a class="code" href="classx4epibase.html#aeed34ca9ad6f09134194281dcd7b64b3">getLanguageOverlay</a>();
<a name="l00359"></a>00359                         $params = array(<span class="stringliteral">&quot;category&quot;</span> =&gt; $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>]);
<a name="l00360"></a>00360                         $markerArray[<span class="stringliteral">&#39;###item###&#39;</span>] = $this-&gt;pi_linkTP_keepPIvars($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$catLabelField], $params,1,0,$altPageUid);
<a name="l00361"></a>00361                         $markerArray[<span class="stringliteral">&#39;###itemLabel###&#39;</span>] = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$catLabelField];
<a name="l00362"></a>00362                         $markerArray[<span class="stringliteral">&#39;###itemUid###&#39;</span>] = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>];
<a name="l00363"></a>00363                         <span class="keywordflow">if</span>($this-&gt;piVars[<span class="stringliteral">&#39;category&#39;</span>] == $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>]) {
<a name="l00364"></a>00364                                 $markerArray[<span class="stringliteral">&#39;###class###&#39;</span>] = <span class="stringliteral">&#39;act&#39;</span>;
<a name="l00365"></a>00365                                 $markerArray[<span class="stringliteral">&#39;###selected###&#39;</span>] = <span class="stringliteral">&#39;selected=&quot;selected&quot;&#39;</span>;
<a name="l00366"></a>00366                         } <span class="keywordflow">else</span> {
<a name="l00367"></a>00367                                 $markerArray[<span class="stringliteral">&#39;###class###&#39;</span>] = <span class="stringliteral">&#39;no&#39;</span>;
<a name="l00368"></a>00368                                 $markerArray[<span class="stringliteral">&#39;###selected###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00369"></a>00369                         }
<a name="l00370"></a>00370                         $items .= $this-&gt;cObj-&gt;substituteMarkerArrayCached($template[<span class="stringliteral">&#39;menu&#39;</span>], $markerArray);
<a name="l00371"></a>00371                 }
<a name="l00372"></a>00372                 $this-&gt;tableName = $bakTable;
<a name="l00373"></a>00373                 $subpartArray[<span class="stringliteral">&#39;###menu###&#39;</span>] = $items;
<a name="l00374"></a>00374                 $markerArray[<span class="stringliteral">&#39;###categorySearchLabel###&#39;</span>] = $this-&gt;pi_getLL(<span class="stringliteral">&#39;categorySearchLabel&#39;</span>);
<a name="l00375"></a>00375                 $content = $this-&gt;cObj-&gt;substituteMarkerArrayCached($template[<span class="stringliteral">&#39;total&#39;</span>], $markerArray, $subpartArray);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377                 <span class="keywordflow">return</span> $content;
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379 
<a name="l00388"></a><a class="code" href="classx4epibase.html#ae4e1ebf4626f92874f3299d18b1d9c5d">00388</a>         function <a class="code" href="classx4epibase.html#ae4e1ebf4626f92874f3299d18b1d9c5d">listByCategory</a>($step=-1) {
<a name="l00389"></a>00389                 global $TCA;
<a name="l00390"></a>00390                 
<a name="l00391"></a>00391                 $limit = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00392"></a>00392                 <span class="keywordflow">if</span> ($step&gt;=0) {
<a name="l00393"></a>00393                         $limit = intval($step).<span class="stringliteral">&#39;,1&#39;</span>;
<a name="l00394"></a>00394                 }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396                 $catsPID = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;categoryPidList&#39;</span>);
<a name="l00397"></a>00397                 <span class="keywordflow">if</span>($catsPID == <span class="stringliteral">&#39;{$plugin.tx_x4econgress_pi1.pidList}&#39;</span>) $catsPID = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;pidList&#39;</span>);
<a name="l00398"></a>00398                 
<a name="l00399"></a>00399                 $addWhere = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00400"></a>00400                         <span class="comment">// if category is selected, show only this category</span>
<a name="l00401"></a>00401                 <span class="keywordflow">if</span> (intval($this-&gt;piVars[<span class="stringliteral">&#39;category&#39;</span>])&gt;0) {
<a name="l00402"></a>00402                         $addWhere .= <span class="stringliteral">&#39; AND &#39;</span>.$this-&gt;categoryTable.<span class="stringliteral">&#39;.uid = &#39;</span>.intval($this-&gt;piVars[<span class="stringliteral">&#39;category&#39;</span>]);
<a name="l00403"></a>00403                 }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405                 $sortBy = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00406"></a>00406                 <span class="keywordflow">if</span> (isset($TCA[$this-&gt;categoryTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;sortby&#39;</span>])) {
<a name="l00407"></a>00407                         $sortBy = $TCA[$this-&gt;categoryTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;sortby&#39;</span>];
<a name="l00408"></a>00408                 } elseif (isset($TCA[$this-&gt;categoryTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;default_sortby&#39;</span>])) {
<a name="l00409"></a>00409                         $sortBy = trim(str_replace(<span class="stringliteral">&#39;ORDER BY&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$TCA[$this-&gt;categoryTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;default_sortby&#39;</span>]));
<a name="l00410"></a>00410                 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412                 $cats = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECTquery(<span class="charliteral">&#39;*&#39;</span>,$this-&gt;categoryTable,$this-&gt;categoryTable.<span class="stringliteral">&#39;.pid IN (&#39;</span>.$catsPID.<span class="charliteral">&#39;)&#39;</span>.$this-&gt;cObj-&gt;enableFields($this-&gt;categoryTable).$addWhere,$sortBy,$limit);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">template</span> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00415"></a>00415                         $this-&gt;<span class="keyword">template</span> = $this-&gt;cObj-&gt;fileResource($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;categoryViewTemplate&#39;</span>]);
<a name="l00416"></a>00416                 }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">template</span> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00419"></a>00419                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;No template found...&#39;</span>;
<a name="l00420"></a>00420                 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422                 $tmpl = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###listView###&#39;</span>);
<a name="l00423"></a>00423                 <span class="keywordflow">while</span>($c = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_assoc($cats)) {
<a name="l00424"></a>00424                         $this-&gt;currentCategory = $c;
<a name="l00425"></a>00425                         $sub[<span class="stringliteral">&#39;###listView###&#39;</span>] .= $this-&gt;<a class="code" href="classx4epibase.html#adb663ca803c01138de6da20f89abd058">renderCategory</a>($c);
<a name="l00426"></a>00426                 }
<a name="l00427"></a>00427                 unset($m,$s,$tmpl,$c);
<a name="l00428"></a>00428                 $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_free_result($cats);
<a name="l00429"></a>00429                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArrayCached($this-&gt;<span class="keyword">template</span>,array(),$sub);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00439"></a><a class="code" href="classx4epibase.html#adb663ca803c01138de6da20f89abd058">00439</a>         function <a class="code" href="classx4epibase.html#adb663ca803c01138de6da20f89abd058">renderCategory</a>(&amp;$category) {
<a name="l00440"></a>00440                 global $TCA;
<a name="l00441"></a>00441                 t3lib_div::loadTCA($this-&gt;categoryTable);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                 <span class="keywordflow">if</span> (isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>][$this-&gt;categoryField][<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;MM&#39;</span>])) {
<a name="l00444"></a>00444                         $where = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;SELECTquery(<span class="stringliteral">&#39;uid_local&#39;</span>,$TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>][$this-&gt;categoryField][<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;MM&#39;</span>],<span class="stringliteral">&#39;uid_foreign = &#39;</span>.$category[<span class="stringliteral">&#39;uid&#39;</span>]);
<a name="l00445"></a>00445                         $where = <span class="stringliteral">&#39;uid IN (&#39;</span>.$where.<span class="charliteral">&#39;)&#39;</span>;
<a name="l00446"></a>00446                 } <span class="keywordflow">else</span> {
<a name="l00447"></a>00447                         $where = $this-&gt;categoryField.<span class="charliteral">&#39;=&#39;</span>.intval($category[<span class="stringliteral">&#39;uid&#39;</span>]);
<a name="l00448"></a>00448                 }
<a name="l00449"></a>00449                 
<a name="l00450"></a>00450                 $s[<span class="stringliteral">&#39;###list###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a2d5f4904171be2f41c2d0c09de9ff234">listView</a>(<span class="stringliteral">&#39; AND &#39;</span>.$where);
<a name="l00451"></a>00451                 $bakTable = $this-&gt;tableName;
<a name="l00452"></a>00452                 $this-&gt;tableName = $this-&gt;categoryTable;
<a name="l00453"></a>00453                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>] = $category;
<a name="l00454"></a>00454                 $this-&gt;<a class="code" href="classx4epibase.html#aeed34ca9ad6f09134194281dcd7b64b3">getLanguageOverlay</a>();
<a name="l00455"></a>00455                 $m[<span class="stringliteral">&#39;###categoryLabel###&#39;</span>] = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$TCA[$this-&gt;categoryTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>]];
<a name="l00456"></a>00456                 $m[<span class="stringliteral">&#39;###categoryUid###&#39;</span>] = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>];
<a name="l00457"></a>00457                 $this-&gt;tableName = $bakTable;
<a name="l00458"></a>00458                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArray($s[<span class="stringliteral">&#39;###list###&#39;</span>],$m);
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 
<a name="l00467"></a><a class="code" href="classx4epibase.html#a4c2512227263b9829906459171311f35">00467</a>         function <a class="code" href="classx4epibase.html#a4c2512227263b9829906459171311f35">numberOfCategories</a>() {
<a name="l00468"></a>00468                 $res = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECTgetRows(<span class="stringliteral">&#39;count(*)&#39;</span>,$this-&gt;categoryTable,$this-&gt;categoryTable.<span class="stringliteral">&#39;.pid IN (&#39;</span>.$this-&gt;getTSFFvar(<span class="stringliteral">&#39;pidList&#39;</span>).<span class="charliteral">&#39;)&#39;</span>.$this-&gt;cObj-&gt;enableFields($this-&gt;categoryTable),<span class="stringliteral">&#39;&#39;</span>,$TCA[$this-&gt;categoryTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;sortby&#39;</span>]);
<a name="l00469"></a>00469                 <span class="keywordflow">return</span> $res[0][<span class="stringliteral">&#39;count(*)&#39;</span>];
<a name="l00470"></a>00470         }
<a name="l00471"></a>00471 
<a name="l00478"></a><a class="code" href="classx4epibase.html#a85c59bec398aaeda545536aa91764614">00478</a>         function <a class="code" href="classx4epibase.html#a85c59bec398aaeda545536aa91764614">initListView</a>() {
<a name="l00479"></a>00479                 $this-&gt;lConf = $lConf = $this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>];       <span class="comment">// Local settings for the listView function</span>
<a name="l00480"></a>00480                 $this-&gt;pi_alwaysPrev = $this-&gt;lConf[<span class="stringliteral">&#39;alwaysPrev&#39;</span>];
<a name="l00481"></a>00481                 $this-&gt;viewMode = <span class="stringliteral">&#39;listView&#39;</span>;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483                 <span class="comment">//if (!isset($this-&gt;piVars[&#39;pointer&#39;])) $this-&gt;piVars[&#39;pointer&#39;]=0;</span>
<a name="l00484"></a>00484                 
<a name="l00485"></a>00485                 <span class="keywordflow">if</span> (!isset($this-&gt;piVars[<span class="stringliteral">&#39;sort&#39;</span>]))      $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>]=array_shift(explode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderByList&#39;</span>]));
<a name="l00486"></a>00486 
<a name="l00487"></a>00487                         <span class="comment">// Initializing the query parameters:</span>
<a name="l00488"></a>00488                 <span class="keywordflow">if</span> (isset($this-&gt;piVars[<span class="stringliteral">&#39;sort&#39;</span>])) {
<a name="l00489"></a>00489                         list($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>],$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;descFlag&#39;</span>]) = explode(<span class="charliteral">&#39;:&#39;</span>,$this-&gt;piVars[<span class="stringliteral">&#39;sort&#39;</span>]);
<a name="l00490"></a>00490                 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>] == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00493"></a>00493                         $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>]=array_shift(explode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderByList&#39;</span>]));
<a name="l00494"></a>00494                 }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;results_at_a_time&#39;</span>]=t3lib_div::intInRange($lConf[<span class="stringliteral">&#39;results_at_a_time&#39;</span>],0,1000,3);               <span class="comment">// Number of results to show in a listing.</span>
<a name="l00497"></a>00497                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;maxPages&#39;</span>]=t3lib_div::intInRange($lConf[<span class="stringliteral">&#39;maxPages&#39;</span>],0,1000,2);;                <span class="comment">// The maximum number of &quot;pages&quot; in the browse-box: &quot;Page 1&quot;, &#39;Page 2&#39;, etc.</span>
<a name="l00498"></a>00498 
<a name="l00499"></a>00499                 <span class="comment">//$this-&gt;internal[&#39;results_at_a_time&#39;] = $lConf[&#39;results_at_a_time&#39;];</span>
<a name="l00500"></a>00500 
<a name="l00501"></a>00501                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;showFirstLast&#39;</span>] = $lConf[<span class="stringliteral">&#39;showFirstLast&#39;</span>];
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503 
<a name="l00510"></a><a class="code" href="classx4epibase.html#a9066fd925429222a9633c49a09e1b90a">00510</a>         function <a class="code" href="classx4epibase.html#a9066fd925429222a9633c49a09e1b90a">listOfDetailView</a>($addWhere=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l00511"></a>00511                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">template</span> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00512"></a>00512                         $this-&gt;<span class="keyword">template</span> = $this-&gt;cObj-&gt;fileResource($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;template&#39;</span>]);
<a name="l00513"></a>00513                 }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515                 <span class="keywordflow">if</span> (trim($this-&gt;<span class="keyword">template</span>) == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00516"></a>00516                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;No template available. According to the current TS-Template, the template is supposed to be at &#39;</span>.$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;template&#39;</span>];
<a name="l00517"></a>00517                 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519                 $addWhere .= $this-&gt;<a class="code" href="classx4epibase.html#a5f5bfc3bb7d7d58fd775d825bf7329a9">getDefinedWhereCondition</a>();
<a name="l00520"></a>00520                 $addWhere .= $this-&gt;<a class="code" href="classx4epibase.html#ad943eaaf1def6cc989891f4a05c5b291">addSearchParameters</a>();
<a name="l00521"></a>00521 
<a name="l00522"></a>00522                 $this-&gt;<a class="code" href="classx4epibase.html#a85c59bec398aaeda545536aa91764614">initListView</a>();
<a name="l00523"></a>00523 
<a name="l00524"></a>00524                 $tmpl = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###listOfDetailView###&#39;</span>);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526                 $res = $this-&gt;pi_exec_query($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentTable&#39;</span>],1,$addWhere);
<a name="l00527"></a>00527                 
<a name="l00528"></a>00528                 list($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;res_count&#39;</span>]) = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_row($res);
<a name="l00529"></a>00529                 
<a name="l00530"></a>00530                 $mArr = $this-&gt;globalMarkerArray;
<a name="l00531"></a>00531                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;res_count&#39;</span>] &gt; 0) {
<a name="l00532"></a>00532                         $res = $this-&gt;pi_exec_query($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentTable&#39;</span>],0,$addWhere);
<a name="l00533"></a>00533                         $tmplBak = $this-&gt;<span class="keyword">template</span>;
<a name="l00534"></a>00534                         $uidBackup = $this-&gt;piVars[<span class="stringliteral">&#39;showUid&#39;</span>];
<a name="l00535"></a>00535                         unset($this-&gt;piVars[<span class="stringliteral">&#39;showUid&#39;</span>]);
<a name="l00536"></a>00536                         $this-&gt;<span class="keyword">template</span> = $this-&gt;cObj-&gt;getSubpart($tmpl,<span class="stringliteral">&#39;###listElements###&#39;</span>);
<a name="l00537"></a>00537                         <span class="keywordflow">while</span>($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>] = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_assoc($res)) {
<a name="l00538"></a>00538                                 $subArr[<span class="stringliteral">&#39;###listElements###&#39;</span>] .= $this-&gt;<a class="code" href="classx4epibase.html#a01e521ebe17734a191faad2124b10760">singleView</a>();
<a name="l00539"></a>00539                         }
<a name="l00540"></a>00540                         
<a name="l00541"></a>00541                         $this-&gt;piVars[<span class="stringliteral">&#39;showUid&#39;</span>] = $uidBackup;
<a name="l00542"></a>00542                         $this-&gt;<span class="keyword">template</span> = $tmplBak;
<a name="l00543"></a>00543                         $mArr[<span class="stringliteral">&#39;###noResultFound###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00544"></a>00544                                 <span class="comment">// Adds the result browser:</span>
<a name="l00545"></a>00545                         <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;res_count&#39;</span>] &lt;= $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;results_at_a_time&#39;</span>]) {
<a name="l00546"></a>00546                                 $mArr[<span class="stringliteral">&#39;###pageBrowser###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00547"></a>00547                         } <span class="keywordflow">else</span> {
<a name="l00548"></a>00548                                 $mArr[<span class="stringliteral">&#39;###pageBrowser###&#39;</span>] = $this-&gt;pi_list_browseresults($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;showResultCount&#39;</span>],<span class="stringliteral">&#39;&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>]);
<a name="l00549"></a>00549                         }
<a name="l00550"></a>00550                 } <span class="keywordflow">else</span> {
<a name="l00551"></a>00551                         $subArr[<span class="stringliteral">&#39;###list###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00552"></a>00552                         $subArr[<span class="stringliteral">&#39;###listElements###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00553"></a>00553                         $mArr[<span class="stringliteral">&#39;###noResultFound###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a6f4ae146a0d776b849007782657770bd">noResultFound</a>();
<a name="l00554"></a>00554                         $mArr[<span class="stringliteral">&#39;###pageBrowser###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00555"></a>00555                 }
<a name="l00556"></a>00556                 $subArr[<span class="stringliteral">&#39;###linkBox###&#39;</span>] = $this-&gt;cObj-&gt;substituteMarker($this-&gt;cObj-&gt;getSubpart($this-&gt;template,<span class="stringliteral">&#39;###linkBox###&#39;</span>),<span class="stringliteral">&#39;###backLink###&#39;</span>,$this-&gt;<a class="code" href="classx4epibase.html#a94846430495f3f87fe8a5becb9ca5a9e">getBackLink</a>());
<a name="l00557"></a>00557                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArrayCached($tmpl,$mArr,$subArr);
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 
<a name="l00567"></a><a class="code" href="classx4epibase.html#a3db1d1080555f083098284d99c00f12f">00567</a>         function <a class="code" href="classx4epibase.html#a3db1d1080555f083098284d99c00f12f">listByAlphabet</a>()       {
<a name="l00568"></a>00568                 $items = $this-&gt;conf[<span class="stringliteral">&#39;alphabeticalList.&#39;</span>][<span class="stringliteral">&#39;menu.&#39;</span>];
<a name="l00569"></a>00569                 $alphabet = <span class="stringliteral">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>;
<a name="l00570"></a>00570                 <span class="comment">// create menu</span>
<a name="l00571"></a>00571                 $content .= $this-&gt;<a class="code" href="classx4epibase.html#aa6cb6d38cd3b8124dc638b680c0e43ff">getAlphabeticalMenu</a>($items);
<a name="l00572"></a>00572                 <span class="comment">// create additional where statement</span>
<a name="l00573"></a>00573                 $filter = strtolower($this-&gt;piVars[<span class="stringliteral">&#39;alphabetFilter&#39;</span>]);
<a name="l00574"></a>00574                 <span class="keywordflow">if</span>($filter != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00575"></a>00575                         $filterArr = explode(<span class="charliteral">&#39;-&#39;</span>, $filter);
<a name="l00576"></a>00576                         $begin = strpos($alphabet, trim($filterArr[0]));
<a name="l00577"></a>00577                         $end = strrpos($alphabet, trim($filterArr[1]));
<a name="l00578"></a>00578                         $chars = substr($alphabet, 0, $end+1);
<a name="l00579"></a>00579                         $chars = substr($chars, $begin);
<a name="l00580"></a>00580                         $conditions = array();
<a name="l00581"></a>00581                         <span class="keywordflow">for</span>($i = 0; $i &lt; strlen($chars); $i++) {
<a name="l00582"></a>00582                                 $char = substr($chars, $i, 1);
<a name="l00583"></a>00583                                 array_push($conditions, $this-&gt;conf[<span class="stringliteral">&#39;alphabeticalList.&#39;</span>][<span class="stringliteral">&#39;orderByField&#39;</span>].<span class="stringliteral">&#39; LIKE &quot;&#39;</span>.$char.<span class="stringliteral">&#39;%&quot;&#39;</span>);
<a name="l00584"></a>00584                                 array_push($conditions, $this-&gt;conf[<span class="stringliteral">&#39;alphabeticalList.&#39;</span>][<span class="stringliteral">&#39;orderByField&#39;</span>].<span class="stringliteral">&#39; LIKE &quot;\&quot;&#39;</span>.$char.<span class="stringliteral">&#39;%&quot;&#39;</span>);
<a name="l00585"></a>00585                         }
<a name="l00586"></a>00586                         $where = <span class="stringliteral">&#39;AND (&#39;</span>.implode(<span class="stringliteral">&#39; OR &#39;</span>, $conditions).<span class="charliteral">&#39;)&#39;</span>;
<a name="l00587"></a>00587                 }
<a name="l00588"></a>00588                         <span class="keywordflow">else</span> $where = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00589"></a>00589                 $content .= $this-&gt;<a class="code" href="classx4epibase.html#a2d5f4904171be2f41c2d0c09de9ff234">listView</a>($where);
<a name="l00590"></a>00590                 <span class="keywordflow">return</span> $content;
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592 
<a name="l00600"></a><a class="code" href="classx4epibase.html#aa6cb6d38cd3b8124dc638b680c0e43ff">00600</a>         function <a class="code" href="classx4epibase.html#aa6cb6d38cd3b8124dc638b680c0e43ff">getAlphabeticalMenu</a>($items) {
<a name="l00601"></a>00601                 $templateCode = $this-&gt;cObj-&gt;fileResource($this-&gt;conf[<span class="stringliteral">&#39;alphabeticalList.&#39;</span>][<span class="stringliteral">&#39;template&#39;</span>]);
<a name="l00602"></a>00602                 $template[<span class="stringliteral">&#39;total&#39;</span>] = $this-&gt;cObj-&gt;getSubpart($templateCode, <span class="stringliteral">&#39;###alphabeticalMenu###&#39;</span>);
<a name="l00603"></a>00603                 $template[<span class="stringliteral">&#39;menu&#39;</span>] = $this-&gt;cObj-&gt;getSubpart($template[<span class="stringliteral">&#39;total&#39;</span>], <span class="stringliteral">&#39;###menu###&#39;</span>);
<a name="l00604"></a>00604                 <span class="keywordflow">foreach</span>($items as $item) {
<a name="l00605"></a>00605                         $params = array(<span class="stringliteral">&#39;parameter&#39;</span> =&gt; $GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;<span class="keywordtype">id</span>);
<a name="l00606"></a>00606                         <span class="keywordflow">if</span>($item == <span class="stringliteral">&#39;all&#39;</span>) {
<a name="l00607"></a>00607                         } <span class="keywordflow">else</span> {
<a name="l00608"></a>00608                                         $params[<span class="stringliteral">&#39;additionalParams&#39;</span>] = <span class="charliteral">&#39;&amp;&#39;</span>.$this-&gt;prefixId.<span class="stringliteral">&#39;[alphabetFilter]=&#39;</span>.$item;
<a name="l00609"></a>00609                         }
<a name="l00610"></a>00610                         <span class="comment">// Aktiver Status</span>
<a name="l00611"></a>00611                         <span class="keywordflow">if</span>($this-&gt;piVars[<span class="stringliteral">&#39;alphabetFilter&#39;</span>] == $item) $params[<span class="stringliteral">&#39;ATagParams&#39;</span>] = <span class="stringliteral">&#39;class=&quot;active-alphabetfilter&quot;&#39;</span>;
<a name="l00612"></a>00612                         $markerArray[<span class="stringliteral">&#39;###item###&#39;</span>] = $this-&gt;cObj-&gt;typolink($item, $params);
<a name="l00613"></a>00613                         $menuItems .= $this-&gt;cObj-&gt;substituteMarkerArrayCached($template[<span class="stringliteral">&#39;menu&#39;</span>], $markerArray);
<a name="l00614"></a>00614                 }
<a name="l00615"></a>00615                 $subpartArray[<span class="stringliteral">&#39;###menu###&#39;</span>] = $menuItems;
<a name="l00616"></a>00616                 $content = $this-&gt;cObj-&gt;substituteMarkerArrayCached($template[<span class="stringliteral">&#39;total&#39;</span>], $markerArray, $subpartArray);
<a name="l00617"></a>00617                 <span class="keywordflow">return</span> $content;
<a name="l00618"></a>00618         }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 
<a name="l00626"></a><a class="code" href="classx4epibase.html#ad943eaaf1def6cc989891f4a05c5b291">00626</a>         function <a class="code" href="classx4epibase.html#ad943eaaf1def6cc989891f4a05c5b291">addSearchParameters</a>() {
<a name="l00627"></a>00627                 global $TCA;
<a name="l00628"></a>00628                 $queries = array();
<a name="l00629"></a>00629                 <span class="keywordflow">foreach</span>($this-&gt;piVars as $k=&gt;$v) {
<a name="l00630"></a>00630                         <span class="keywordflow">if</span> (intval($v)&gt;0) {
<a name="l00631"></a>00631                                 $conf = $TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>][$k][<span class="stringliteral">&#39;config&#39;</span>];
<a name="l00632"></a>00632                                 <span class="keywordflow">if</span> (isset($conf[<span class="stringliteral">&#39;foreign_table&#39;</span>])) {
<a name="l00633"></a>00633                                         <span class="keywordflow">if</span> (isset($conf[<span class="stringliteral">&#39;MM&#39;</span>])) {
<a name="l00634"></a>00634                                                 $q = <span class="stringliteral">&#39;uid IN (&#39;</span>.$GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;SELECTquery(<span class="stringliteral">&#39;uid_local&#39;</span>,$conf[<span class="stringliteral">&#39;MM&#39;</span>],<span class="stringliteral">&#39;uid_foreign=&#39;</span>.intval($v)).<span class="charliteral">&#39;)&#39;</span>;
<a name="l00635"></a>00635                                                 array_push($queries,$q);
<a name="l00636"></a>00636                                                 unset($q);
<a name="l00637"></a>00637                                         } <span class="keywordflow">else</span> {
<a name="l00638"></a>00638                                                 array_push($queries,$k.<span class="charliteral">&#39;=&#39;</span>.intval($v));
<a name="l00639"></a>00639                                         }
<a name="l00640"></a>00640                                 }
<a name="l00641"></a>00641                         }
<a name="l00642"></a>00642                 }
<a name="l00643"></a>00643                 <span class="keywordflow">if</span> (count($queries)&gt;0) {
<a name="l00644"></a>00644                         <span class="keywordflow">return</span> <span class="stringliteral">&#39; AND &#39;</span>.implode(<span class="stringliteral">&#39; AND &#39;</span>,$queries);
<a name="l00645"></a>00645                 } <span class="keywordflow">else</span> {
<a name="l00646"></a>00646                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00647"></a>00647                 }
<a name="l00648"></a>00648         }
<a name="l00649"></a>00649 
<a name="l00656"></a><a class="code" href="classx4epibase.html#a2d5f4904171be2f41c2d0c09de9ff234">00656</a>         function <a class="code" href="classx4epibase.html#a2d5f4904171be2f41c2d0c09de9ff234">listView</a>($addWhere=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00657"></a>00657                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">template</span> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00658"></a>00658                         $this-&gt;<span class="keyword">template</span> = $this-&gt;cObj-&gt;fileResource($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;template&#39;</span>]);
<a name="l00659"></a>00659                 }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">template</span> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00662"></a>00662                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;No template for list view found. File: &#39;</span>.$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;template&#39;</span>];
<a name="l00663"></a>00663                 }
<a name="l00664"></a>00664 
<a name="l00665"></a>00665                 <span class="keywordflow">if</span> ($this-&gt;listT == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00666"></a>00666                         $this-&gt;listT = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###list###&#39;</span>);
<a name="l00667"></a>00667                 }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669                 $this-&gt;rowsT = $this-&gt;cObj-&gt;getSubpart($this-&gt;listT,<span class="stringliteral">&#39;###rows###&#39;</span>);
<a name="l00670"></a>00670                 $this-&gt;rowT[0] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowsT,<span class="stringliteral">&#39;###row0###&#39;</span>);
<a name="l00671"></a>00671                 $this-&gt;rowT[1] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowsT,<span class="stringliteral">&#39;###row1###&#39;</span>);
<a name="l00672"></a>00672                 $this-&gt;cellT[0] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowT[0],<span class="stringliteral">&#39;###cell###&#39;</span>);
<a name="l00673"></a>00673                 $this-&gt;cellT[1] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowT[1],<span class="stringliteral">&#39;###cell###&#39;</span>);
<a name="l00674"></a>00674                 $this-&gt;lConf = $lConf = $this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>];       <span class="comment">// Local settings for the listView function</span>
<a name="l00675"></a>00675 
<a name="l00676"></a>00676                 $this-&gt;<a class="code" href="classx4epibase.html#a85c59bec398aaeda545536aa91764614">initListView</a>();
<a name="l00677"></a>00677                 $addWhere .= $this-&gt;<a class="code" href="classx4epibase.html#a5f5bfc3bb7d7d58fd775d825bf7329a9">getDefinedWhereCondition</a>();
<a name="l00678"></a>00678                 $addWhere .= $this-&gt;<a class="code" href="classx4epibase.html#ad943eaaf1def6cc989891f4a05c5b291">addSearchParameters</a>();
<a name="l00679"></a>00679 
<a name="l00680"></a>00680                 $res = $this-&gt;pi_exec_query($this-&gt;tableName,1,$addWhere);
<a name="l00681"></a>00681                 list($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;res_count&#39;</span>]) = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_row($res);
<a name="l00682"></a>00682                 
<a name="l00683"></a>00683                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;res_count&#39;</span>] &gt; 0) {
<a name="l00684"></a>00684                         $res = $this-&gt;<a class="code" href="classx4epibase.html#a1f1dce95b14df6c0987492f56f046390">getListResultSet</a>($this-&gt;tableName,$addWhere);
<a name="l00685"></a>00685                         <span class="comment">//$res = $this-&gt;pi_exec_query();</span>
<a name="l00686"></a>00686                                 <span class="comment">// Adds the whole list table</span>
<a name="l00687"></a>00687                         $subArr[<span class="stringliteral">&#39;###list###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a5dcd7231f98603f17e97db2866e703fa">pi_list_makelist</a>($res);
<a name="l00688"></a>00688                         $mArr[<span class="stringliteral">&#39;###noResultFound###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00689"></a>00689 
<a name="l00690"></a>00690                         <span class="comment">// Adds the result browser:</span>
<a name="l00691"></a>00691                         <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;res_count&#39;</span>] &lt;= $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;results_at_a_time&#39;</span>]) {
<a name="l00692"></a>00692                                 $mArr[<span class="stringliteral">&#39;###pageBrowser###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00693"></a>00693                         } <span class="keywordflow">else</span> {
<a name="l00694"></a>00694                                 $mArr[<span class="stringliteral">&#39;###pageBrowser###&#39;</span>] = $this-&gt;pi_list_browseresults(0,<span class="stringliteral">&#39;&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>]);
<a name="l00695"></a>00695                         }
<a name="l00696"></a>00696                 } <span class="keywordflow">else</span> {
<a name="l00697"></a>00697                         $subArr[<span class="stringliteral">&#39;###list###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00698"></a>00698                         $mArr[<span class="stringliteral">&#39;###noResultFound###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a6f4ae146a0d776b849007782657770bd">noResultFound</a>();
<a name="l00699"></a>00699                         $mArr[<span class="stringliteral">&#39;###pageBrowser###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00700"></a>00700                 }
<a name="l00701"></a>00701                         <span class="comment">// Adds the search box:</span>
<a name="l00702"></a>00702                 $mArr[<span class="stringliteral">&#39;###search###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a777911bc267d8f01207a10197b343191">pi_list_searchBox</a>();
<a name="l00703"></a>00703                 $mArr = $this-&gt;<a class="code" href="classx4epibase.html#afcfe263364d7a892ad37a0cd4c337471">additionalListMarkers</a>($mArr);
<a name="l00704"></a>00704                 $tmpl = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###listView###&#39;</span>);
<a name="l00705"></a>00705                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArrayCached($tmpl,$mArr,$subArr);
<a name="l00706"></a>00706         }
<a name="l00707"></a>00707 
<a name="l00714"></a><a class="code" href="classx4epibase.html#afcfe263364d7a892ad37a0cd4c337471">00714</a>         function <a class="code" href="classx4epibase.html#afcfe263364d7a892ad37a0cd4c337471">additionalListMarkers</a> ($mArr){
<a name="l00715"></a>00715                 <span class="keywordflow">return</span> $mArr;
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 
<a name="l00727"></a><a class="code" href="classx4epibase.html#a1f1dce95b14df6c0987492f56f046390">00727</a>         function <a class="code" href="classx4epibase.html#a1f1dce95b14df6c0987492f56f046390">getListResultSet</a>(<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>,$addWhere=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l00728"></a>00728                 global $TCA;
<a name="l00729"></a>00729                 <span class="keywordflow">if</span> (isset($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>])) {
<a name="l00730"></a>00730                         $conf = $TCA[<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>][<span class="stringliteral">&#39;columns&#39;</span>][$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>]][<span class="stringliteral">&#39;config&#39;</span>];
<a name="l00731"></a>00731                         <span class="keywordflow">if</span> (isset($conf[<span class="stringliteral">&#39;foreign_table&#39;</span>]) &amp;&amp; !isset($conf[<span class="stringliteral">&#39;MM&#39;</span>])) {
<a name="l00732"></a>00732                                 $queryParts = $this-&gt;<a class="code" href="classx4epibase.html#a5f679afda454b41ae5977b61c31ca16a">pi_list_query</a>(<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>,0,$addWhere,<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,<span class="keyword">true</span>);
<a name="l00733"></a>00733                                 $queryParts[<span class="stringliteral">&#39;FROM&#39;</span>] .= <span class="stringliteral">&#39; LEFT JOIN &#39;</span>.$conf[<span class="stringliteral">&#39;foreign_table&#39;</span>].<span class="stringliteral">&#39; ON &#39;</span>.$conf[<span class="stringliteral">&#39;foreign_table&#39;</span>].<span class="stringliteral">&#39;.uid=&#39;</span>.<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>.<span class="charliteral">&#39;.&#39;</span>.$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>];
<a name="l00734"></a>00734                                 $queryParts[<span class="stringliteral">&#39;ORDERBY&#39;</span>] = $conf[<span class="stringliteral">&#39;foreign_table&#39;</span>].<span class="charliteral">&#39;.&#39;</span>.$TCA[$conf[<span class="stringliteral">&#39;foreign_table&#39;</span>]][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>].($this-&gt;internal[<span class="stringliteral">&#39;descFlag&#39;</span>]?<span class="stringliteral">&#39; DESC&#39;</span>:<span class="stringliteral">&#39;&#39;</span>);
<a name="l00735"></a>00735                                 <span class="keywordflow">return</span> $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECT_queryArray($queryParts);
<a name="l00736"></a>00736                         }
<a name="l00737"></a>00737                 }
<a name="l00738"></a>00738                 <span class="keywordflow">return</span> $this-&gt;pi_exec_query(<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>,0,$addWhere);
<a name="l00739"></a>00739         }
<a name="l00740"></a>00740         
<a name="l00741"></a>00741 
<a name="l00753"></a><a class="code" href="classx4epibase.html#a5f5bfc3bb7d7d58fd775d825bf7329a9">00753</a>         function <a class="code" href="classx4epibase.html#a5f5bfc3bb7d7d58fd775d825bf7329a9">getDefinedWhereCondition</a>() {
<a name="l00754"></a>00754                 $parameters = t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$this-&gt;conf[<span class="stringliteral">&#39;whereFields&#39;</span>],1);
<a name="l00755"></a>00755                 $conds = array();
<a name="l00756"></a>00756                 <span class="keywordflow">if</span> ($this-&gt;conf[<span class="stringliteral">&#39;addtionalWhereCondition&#39;</span>]) {
<a name="l00757"></a>00757                         array_push($conds, $this-&gt;conf[<span class="stringliteral">&#39;addtionalWhereCondition&#39;</span>]);
<a name="l00758"></a>00758                 }
<a name="l00759"></a>00759                 global $TCA;
<a name="l00760"></a>00760                 <span class="keywordflow">foreach</span>($parameters as $p) {
<a name="l00761"></a>00761                         $conf = $TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>][$p];
<a name="l00762"></a>00762                         <span class="keywordflow">if</span> (isset($this-&gt;piVars[$p])) {
<a name="l00763"></a>00763                                 array_push($conds,$p.<span class="charliteral">&#39;=&#39;</span>.intval($this-&gt;piVars[$p]));
<a name="l00764"></a>00764                         }
<a name="l00765"></a>00765                         <span class="comment">// if condition is a foreign table, add the value to the global</span>
<a name="l00766"></a>00766                         <span class="comment">// markers, as it might be interessting to display</span>
<a name="l00767"></a>00767                         <span class="keywordflow">if</span>(isset($conf[<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;foreign_table&#39;</span>])) {
<a name="l00768"></a>00768                                 $fTable = $conf[<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;foreign_table&#39;</span>];
<a name="l00769"></a>00769                                 $rec = $this-&gt;pi_getRecord($fTable,$this-&gt;piVars[$p]);
<a name="l00770"></a>00770                                 $this-&gt;globalMarkerArray[<span class="stringliteral">&#39;###&#39;</span>.$p.<span class="stringliteral">&#39;###&#39;</span>] = $rec[$TCA[$fTable][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>]];
<a name="l00771"></a>00771                         }
<a name="l00772"></a>00772                 }
<a name="l00773"></a>00773                 <span class="keywordflow">if</span> (count($conds)&gt;0) {
<a name="l00774"></a>00774                         <span class="keywordflow">return</span> <span class="stringliteral">&#39; AND &#39;</span>.implode(<span class="stringliteral">&#39; AND &#39;</span>,$conds);
<a name="l00775"></a>00775                 } <span class="keywordflow">else</span> {
<a name="l00776"></a>00776                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00777"></a>00777                 }
<a name="l00778"></a>00778         }
<a name="l00779"></a>00779 
<a name="l00786"></a><a class="code" href="classx4epibase.html#a3f4d4db77e67041cf407532bffbd959f">00786</a>         function <a class="code" href="classx4epibase.html#a3f4d4db77e67041cf407532bffbd959f">getFieldContent</a>($fN)   {
<a name="l00787"></a>00787                 global $TCA;
<a name="l00788"></a>00788                 $t = $TCA[$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentTable&#39;</span>]][<span class="stringliteral">&#39;columns&#39;</span>][$fN][<span class="stringliteral">&#39;config&#39;</span>];
<a name="l00789"></a>00789                 $this-&gt;<a class="code" href="classx4epibase.html#a229bd25e5617ebc8e2d58da886d6f5f3">handleStdWrap</a>($fN);
<a name="l00790"></a>00790                 <span class="keywordflow">switch</span>($t[<span class="stringliteral">&#39;type&#39;</span>]) {
<a name="l00791"></a>00791                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;input&#39;</span>:
<a name="l00792"></a>00792                                 $out = $this-&gt;<a class="code" href="classx4epibase.html#a5abe7e446a10d99b4c46cd6442d08c51">getInputContent</a>($fN,$t);
<a name="l00793"></a>00793                         <span class="keywordflow">break</span>;
<a name="l00794"></a>00794                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;text&#39;</span>:
<a name="l00795"></a>00795                                 <span class="keywordflow">if</span> (isset($t[<span class="stringliteral">&#39;wizards&#39;</span>][<span class="stringliteral">&#39;RTE&#39;</span>])) {
<a name="l00796"></a>00796                                         <span class="keywordflow">return</span> $this-&gt;pi_RTEcssText($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]);
<a name="l00797"></a>00797                                 } <span class="keywordflow">else</span> {
<a name="l00798"></a>00798                                         $out = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00799"></a>00799                                         <span class="keywordflow">if</span> (!in_array($fN,$this-&gt;skipHtmlEntitiesFields)) {
<a name="l00800"></a>00800                                                 $out = htmlentities($out);
<a name="l00801"></a>00801                                         }
<a name="l00802"></a>00802                                         <span class="keywordflow">return</span> nl2br($out);
<a name="l00803"></a>00803                                 }
<a name="l00804"></a>00804                         <span class="keywordflow">break</span>;
<a name="l00805"></a>00805                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;group&#39;</span>:
<a name="l00806"></a>00806                                 <span class="keywordflow">switch</span>($t[<span class="stringliteral">&#39;internal_type&#39;</span>]){
<a name="l00807"></a>00807                                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;file&#39;</span>:
<a name="l00808"></a>00808                                                 <span class="comment">// images</span>
<a name="l00809"></a>00809                                                 <span class="keywordflow">if</span>($t[<span class="stringliteral">&#39;allowed&#39;</span>] == $GLOBALS[<span class="stringliteral">&quot;TYPO3_CONF_VARS&quot;</span>][<span class="stringliteral">&quot;GFX&quot;</span>][<span class="stringliteral">&quot;imagefile_ext&quot;</span>]) {
<a name="l00810"></a>00810                                                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#a9d40c7afa745837693117a5b6d9a870c">getImages</a>($t,$fN);
<a name="l00811"></a>00811                                                 } <span class="keywordflow">else</span> {
<a name="l00812"></a>00812                                                                 $fileArr = explode(<span class="charliteral">&#39;,&#39;</span>, $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]);
<a name="l00813"></a>00813                                                                 $fileLinkConf = $this-&gt;conf[<span class="stringliteral">&#39;filelink&#39;</span>];
<a name="l00814"></a>00814                                                                 
<a name="l00815"></a>00815                                                                 $fileLinkConf[<span class="stringliteral">&#39;path&#39;</span>] = $t[<span class="stringliteral">&#39;uploadfolder&#39;</span>].<span class="charliteral">&#39;/&#39;</span>;
<a name="l00816"></a>00816                                                                 $fileLinks = array();
<a name="l00817"></a>00817                                                                 <span class="keywordflow">foreach</span> ($fileArr as $file)     {
<a name="l00818"></a>00818                                                                         array_push($fileLinks, $this-&gt;cObj-&gt;filelink($file,$fileLinkConf));
<a name="l00819"></a>00819                                                                 }
<a name="l00820"></a>00820                                                                 <span class="keywordflow">return</span> implode(<span class="stringliteral">&#39;, &#39;</span>, $fileLinks);
<a name="l00821"></a>00821                                                         }
<a name="l00822"></a>00822                                         <span class="keywordflow">break</span>;
<a name="l00823"></a>00823                                         <span class="keywordflow">default</span>:
<a name="l00824"></a>00824                                                 $out = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00825"></a>00825                                         <span class="keywordflow">break</span>;
<a name="l00826"></a>00826                                 }
<a name="l00827"></a>00827                         <span class="keywordflow">break</span>;
<a name="l00828"></a>00828                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;select&#39;</span>:
<a name="l00829"></a>00829                                 <span class="keywordflow">if</span> ($t[<span class="stringliteral">&#39;foreign_table&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00830"></a>00830                                         $out = $this-&gt;<a class="code" href="classx4epibase.html#a411db5e0f16381e20195a8131f0c6b1b">getRelation</a>($t[<span class="stringliteral">&#39;foreign_table&#39;</span>],$fN);
<a name="l00831"></a>00831                                 } <span class="keywordflow">else</span> {
<a name="l00832"></a>00832                                         $out = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00833"></a>00833                                 }
<a name="l00834"></a>00834                         <span class="keywordflow">break</span>;
<a name="l00835"></a>00835                         <span class="keywordflow">default</span>:
<a name="l00836"></a>00836                                 <span class="keywordflow">switch</span>($fN) {
<a name="l00837"></a>00837                                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;crdate&#39;</span>:
<a name="l00838"></a>00838                                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;tsamp&#39;</span>:
<a name="l00839"></a>00839                                                 <span class="keywordflow">if</span> (intval($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN])) {
<a name="l00840"></a>00840                                                         $out = strftime($this-&gt;conf[<span class="stringliteral">&#39;dateFormat&#39;</span>],$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]);
<a name="l00841"></a>00841                                                 } <span class="keywordflow">else</span> {
<a name="l00842"></a>00842                                                         $out = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00843"></a>00843                                                 }
<a name="l00844"></a>00844                                         <span class="keywordflow">break</span>;
<a name="l00845"></a>00845                                         <span class="keywordflow">default</span>:
<a name="l00846"></a>00846                                                 $out = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00847"></a>00847                                         <span class="keywordflow">break</span>;
<a name="l00848"></a>00848                                 }
<a name="l00849"></a>00849                         <span class="keywordflow">break</span>;
<a name="l00850"></a>00850                 }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852                 <span class="comment">// handle utf8 encoding</span>
<a name="l00853"></a>00853                 <span class="keywordflow">if</span> (in_array($fN,$this-&gt;conf[<span class="stringliteral">&#39;utf8DecodeFields&#39;</span>]) || ($this-&gt;conf[<span class="stringliteral">&#39;utf8DecodeFields&#39;</span>][0]==<span class="stringliteral">&#39;all&#39;</span>)) {
<a name="l00854"></a>00854                         $out = utf8_decode($out);
<a name="l00855"></a>00855                 }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857                 <span class="keywordflow">if</span> (!in_array($fN,$this-&gt;skipHtmlEntitiesFields) &amp;&amp; !($this-&gt;skipHtmlEntitiesFields[0]==<span class="stringliteral">&#39;all&#39;</span>)) {
<a name="l00858"></a>00858                         $out = htmlentities($out);
<a name="l00859"></a>00859                 }
<a name="l00860"></a>00860                 
<a name="l00861"></a>00861                 $out = $this-&gt;<a class="code" href="classx4epibase.html#ae2f214d4758711d74554b874fc1bc118">handlePostStdWrap</a>($out);
<a name="l00862"></a>00862                 
<a name="l00863"></a>00863                 <span class="comment">// check if list mode</span>
<a name="l00864"></a>00864                 <span class="keywordflow">if</span> ((!isset($this-&gt;piVars[<span class="stringliteral">&#39;showUid&#39;</span>]) || ($this-&gt;conf[<span class="stringliteral">&#39;detailView.&#39;</span>][<span class="stringliteral">&#39;enableDetailLinks&#39;</span>]==1)) &amp;&amp; in_array($fN,$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;detailLinkFields&#39;</span>])) {
<a name="l00865"></a>00865                         <span class="comment">//$out = $this-&gt;pi_list_linkSingle($out,$this-&gt;internal[&#39;currentRow&#39;][&#39;uid&#39;],true,$p,false,$this-&gt;conf[&#39;listView.&#39;][&#39;detailPageUid&#39;]);</span>
<a name="l00866"></a>00866                         $out = $this-&gt;pi_linkTP_keepPIvars($out,array(<span class="stringliteral">&#39;showUid&#39;</span>=&gt;$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>]),1,0,$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;detailPageUid&#39;</span>]);
<a name="l00867"></a>00867                 }
<a name="l00868"></a>00868 
<a name="l00869"></a>00869                 <span class="keywordflow">return</span> $out;
<a name="l00870"></a>00870         }
<a name="l00871"></a>00871         
<a name="l00878"></a><a class="code" href="classx4epibase.html#ae2f214d4758711d74554b874fc1bc118">00878</a>         function <a class="code" href="classx4epibase.html#ae2f214d4758711d74554b874fc1bc118">handlePostStdWrap</a>($out){
<a name="l00879"></a>00879                 $stdWrapConf = array();
<a name="l00880"></a>00880                 $stdWrapConf = $this-&gt;conf[<span class="stringliteral">&#39;fields.&#39;</span>][$fN.<span class="charliteral">&#39;.&#39;</span>][<span class="stringliteral">&#39;post_stdWrap.&#39;</span>];
<a name="l00881"></a>00881                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;stdWrap($out,$stdWrapConf);
<a name="l00882"></a>00882         }
<a name="l00883"></a>00883 
<a name="l00892"></a><a class="code" href="classx4epibase.html#a9d40c7afa745837693117a5b6d9a870c">00892</a>         function <a class="code" href="classx4epibase.html#a9d40c7afa745837693117a5b6d9a870c">getImages</a>($t, $fN) {
<a name="l00893"></a>00893                 $imgTSConfig = $this-&gt;conf[<span class="stringliteral">&#39;imageConfig.&#39;</span>][<span class="stringliteral">&#39;pictures.&#39;</span>];
<a name="l00894"></a>00894                 $fileString = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00895"></a>00895                 $fileArr = explode(<span class="charliteral">&#39;,&#39;</span>, $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]);
<a name="l00896"></a>00896                 <span class="keywordflow">foreach</span> ($fileArr as $file) {
<a name="l00897"></a>00897                         $imgTSConfig[<span class="stringliteral">&#39;file&#39;</span>] = $t[<span class="stringliteral">&#39;uploadfolder&#39;</span>].<span class="charliteral">&#39;/&#39;</span>.$file;
<a name="l00898"></a>00898                         $fileString .= $this-&gt;cObj-&gt;IMAGE($imgTSConfig);
<a name="l00899"></a>00899                 }
<a name="l00900"></a>00900                 <span class="keywordflow">return</span> $fileString;
<a name="l00901"></a>00901         }
<a name="l00902"></a>00902 
<a name="l00910"></a><a class="code" href="classx4epibase.html#a5abe7e446a10d99b4c46cd6442d08c51">00910</a>         function <a class="code" href="classx4epibase.html#a5abe7e446a10d99b4c46cd6442d08c51">getInputContent</a>($fN,&amp;$t) {
<a name="l00911"></a>00911                 <span class="keywordflow">if</span> (strpos($t[<span class="stringliteral">&#39;eval&#39;</span>],<span class="stringliteral">&#39;date&#39;</span>)!== <span class="keyword">false</span>) {
<a name="l00912"></a>00912                         <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN] != 0) {
<a name="l00913"></a>00913                                 $out = strftime($this-&gt;conf[<span class="stringliteral">&#39;dateFormat&#39;</span>],$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]);
<a name="l00914"></a>00914                         } <span class="keywordflow">else</span> {
<a name="l00915"></a>00915                                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00916"></a>00916                         }
<a name="l00917"></a>00917                 } elseif (isset($t[<span class="stringliteral">&#39;wizards&#39;</span>][<span class="stringliteral">&#39;link&#39;</span>])) {
<a name="l00918"></a>00918                         <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN.<span class="stringliteral">&#39;Original&#39;</span>] == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00919"></a>00919                                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN.<span class="stringliteral">&#39;Original&#39;</span>] = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00920"></a>00920                                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00921"></a>00921                         }
<a name="l00922"></a>00922                         $out = $this-&gt;cObj-&gt;getTypoLink(htmlentities($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]),$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN.<span class="stringliteral">&#39;Original&#39;</span>]);
<a name="l00923"></a>00923                         array_push($this-&gt;skipHtmlEntitiesFields,$fN);
<a name="l00924"></a>00924                 } <span class="keywordflow">else</span> {
<a name="l00925"></a>00925                         $out = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00926"></a>00926                 }
<a name="l00927"></a>00927                 <span class="keywordflow">if</span>($fN == <span class="stringliteral">&#39;email&#39;</span>){
<a name="l00928"></a>00928                         $out = $this-&gt;cObj-&gt;typoLink(htmlentities($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]),array(<span class="stringliteral">&#39;parameter&#39;</span>=&gt;$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]));
<a name="l00929"></a>00929                         array_push($this-&gt;skipHtmlEntitiesFields,$fN);
<a name="l00930"></a>00930                 }
<a name="l00931"></a>00931                 <span class="keywordflow">return</span> $out;
<a name="l00932"></a>00932         }
<a name="l00933"></a>00933 
<a name="l00941"></a><a class="code" href="classx4epibase.html#a229bd25e5617ebc8e2d58da886d6f5f3">00941</a>         function <a class="code" href="classx4epibase.html#a229bd25e5617ebc8e2d58da886d6f5f3">handleStdWrap</a>($fN) {
<a name="l00942"></a>00942                 <span class="keywordflow">if</span> (isset($this-&gt;conf[<span class="stringliteral">&#39;fields.&#39;</span>][$fN.<span class="charliteral">&#39;.&#39;</span>])) {
<a name="l00943"></a>00943                         <span class="comment">// keep original</span>
<a name="l00944"></a>00944                         $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN.<span class="stringliteral">&#39;Original&#39;</span>] = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00945"></a>00945                         $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN] = $this-&gt;cObj-&gt;stdWrap($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN],$this-&gt;conf[<span class="stringliteral">&#39;fields.&#39;</span>][$fN.<span class="charliteral">&#39;.&#39;</span>]);
<a name="l00946"></a>00946                 }
<a name="l00947"></a>00947         }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 
<a name="l00958"></a><a class="code" href="classx4epibase.html#a411db5e0f16381e20195a8131f0c6b1b">00958</a>         function <a class="code" href="classx4epibase.html#a411db5e0f16381e20195a8131f0c6b1b">getRelation</a>($table,$fN) {
<a name="l00959"></a>00959                 global $TCA;
<a name="l00960"></a>00960                 <span class="keywordflow">if</span> (isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>][$fN][<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;MM&#39;</span>])) {
<a name="l00961"></a>00961                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#aea103da87afcdeedc652c15419c5de0f">getMMRelation</a>($table,$fN);
<a name="l00962"></a>00962                 } <span class="keywordflow">else</span> {
<a name="l00963"></a>00963                         <span class="comment">// get regular fields</span>
<a name="l00964"></a>00964                         $id = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN];
<a name="l00965"></a>00965                         <span class="keywordflow">if</span> (!isset($this-&gt;relatedRecords[$table][$id])) {
<a name="l00966"></a>00966                                 $r = $this-&gt;pi_getRecord($table,$id);
<a name="l00967"></a>00967                                 <span class="keywordflow">if</span> (isset($r[<span class="stringliteral">&#39;uid&#39;</span>])) {
<a name="l00968"></a>00968                                         $this-&gt;relatedRecords[$table][$id] = $r[$TCA[$table][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>]];
<a name="l00969"></a>00969                                 } <span class="keywordflow">else</span> {
<a name="l00970"></a>00970                                         $this-&gt;relatedRecords[$table][$id]=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00971"></a>00971                                 }
<a name="l00972"></a>00972                                 unset($r);
<a name="l00973"></a>00973                         }
<a name="l00974"></a>00974                         <span class="keywordflow">return</span> $this-&gt;relatedRecords[$table][$id];
<a name="l00975"></a>00975                 }
<a name="l00976"></a>00976         }
<a name="l00977"></a>00977 
<a name="l00988"></a><a class="code" href="classx4epibase.html#aea103da87afcdeedc652c15419c5de0f">00988</a>         function <a class="code" href="classx4epibase.html#aea103da87afcdeedc652c15419c5de0f">getMMRelation</a>($table,$fN) {
<a name="l00989"></a>00989                 global $TCA;
<a name="l00990"></a>00990                 array_push($this-&gt;skipHtmlEntitiesFields,$fN);
<a name="l00991"></a>00991                 $pi = t3lib_div::makeInstance(<span class="stringliteral">&#39;x4epibase&#39;</span>);
<a name="l00992"></a>00992                 <span class="keywordflow">if</span> (is_array($this-&gt;conf[<span class="stringliteral">&#39;mmRelatedConfig.&#39;</span>][$table.<span class="charliteral">&#39;.&#39;</span>])) {
<a name="l00993"></a>00993                         $pi-&gt;init(<span class="stringliteral">&#39;&#39;</span>,array_merge($this-&gt;conf,$this-&gt;conf[<span class="stringliteral">&#39;mmRelatedConfig.&#39;</span>][$table.<span class="charliteral">&#39;.&#39;</span>]));
<a name="l00994"></a>00994                 }
<a name="l00995"></a>00995                 $pi-&gt;tableName = $table;
<a name="l00996"></a>00996                 $pi-&gt;cObj = $this-&gt;cObj;
<a name="l00997"></a>00997                 $mmTable = $TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>][$fN][<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;MM&#39;</span>];
<a name="l00998"></a>00998                 $pi-&gt;conf[<span class="stringliteral">&#39;addtionalWhereCondition&#39;</span>] = <span class="stringliteral">&#39;uid IN (&#39;</span>.$GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;SELECTquery(<span class="stringliteral">&#39;uid_foreign&#39;</span>,$mmTable,<span class="stringliteral">&#39;uid_local=&#39;</span>.$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>]).<span class="charliteral">&#39;)&#39;</span>;
<a name="l00999"></a>00999                 $pi-&gt;template = $this-&gt;cObj-&gt;getSubpart($this-&gt;completeTemplate,<span class="stringliteral">&#39;###&#39;</span>.$fN.<span class="stringliteral">&#39;RelationBox###&#39;</span>);
<a name="l01000"></a>01000                 <span class="keywordflow">return</span> $pi-&gt;listView();
<a name="l01001"></a>01001         }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003 
<a name="l01016"></a><a class="code" href="classx4epibase.html#a5dcd7231f98603f17e97db2866e703fa">01016</a>         function <a class="code" href="classx4epibase.html#a5dcd7231f98603f17e97db2866e703fa">pi_list_makelist</a>($res) {
<a name="l01017"></a>01017                 <span class="comment">// get all templates</span>
<a name="l01018"></a>01018                 <span class="keywordflow">if</span> ($this-&gt;manualFieldOrder_list == <span class="stringliteral">&#39;&#39;</span>){
<a name="l01019"></a>01019                         $this-&gt;manualFieldOrder_list = $this-&gt;fields;
<a name="l01020"></a>01020                 }
<a name="l01021"></a>01021                 <span class="keywordflow">if</span> ($this-&gt;listT == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01022"></a>01022                         $this-&gt;listT = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###list###&#39;</span>);
<a name="l01023"></a>01023                 }
<a name="l01024"></a>01024                 $this-&gt;rowsT = $this-&gt;cObj-&gt;getSubpart($this-&gt;listT,<span class="stringliteral">&#39;###rows###&#39;</span>);
<a name="l01025"></a>01025                 $this-&gt;rowT[0] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowsT,<span class="stringliteral">&#39;###row0###&#39;</span>);
<a name="l01026"></a>01026                 $this-&gt;rowT[1] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowsT,<span class="stringliteral">&#39;###row1###&#39;</span>);
<a name="l01027"></a>01027                 $this-&gt;cellT[0] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowT[0],<span class="stringliteral">&#39;###cell###&#39;</span>);
<a name="l01028"></a>01028                 $this-&gt;cellT[1] = $this-&gt;cObj-&gt;getSubpart($this-&gt;rowT[1],<span class="stringliteral">&#39;###cell###&#39;</span>);
<a name="l01029"></a>01029                 <span class="comment">// Make list table header:</span>
<a name="l01030"></a>01030                 $tRows=array();
<a name="l01031"></a>01031                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>]=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01032"></a>01032                 <span class="comment">// get header and replace marker</span>
<a name="l01033"></a>01033                 <span class="keywordflow">if</span>(!$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;hideHeaderRow&#39;</span>]){
<a name="l01034"></a>01034                         $out = $this-&gt;cObj-&gt;substituteSubpart($this-&gt;listT,<span class="stringliteral">&#39;###headRow###&#39;</span>,$this-&gt;<a class="code" href="classx4epibase.html#a5110e3ff60e211bfa81d9c50cd4149ca">pi_list_header</a>());
<a name="l01035"></a>01035                 }
<a name="l01036"></a>01036                 
<a name="l01037"></a>01037                         <span class="comment">// Make list table rows</span>
<a name="l01038"></a>01038                 $c=0;
<a name="l01039"></a>01039                 $rows = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01040"></a>01040                 $simpleRows = array();
<a name="l01041"></a>01041                 <span class="keywordflow">while</span>($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>] = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_assoc($res))      {
<a name="l01042"></a>01042                         <span class="keywordflow">if</span> ($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;simpleList&#39;</span>]==1) {
<a name="l01043"></a>01043                                 $simpleRows[] = $this-&gt;<a class="code" href="classx4epibase.html#a407a37fb3e999a439df8e45e7cc31800">pi_list_row</a>($c);
<a name="l01044"></a>01044                         } <span class="keywordflow">else</span> {
<a name="l01045"></a>01045                                 $rows .= $this-&gt;<a class="code" href="classx4epibase.html#a407a37fb3e999a439df8e45e7cc31800">pi_list_row</a>($c);
<a name="l01046"></a>01046                         }
<a name="l01047"></a>01047                         $c++;
<a name="l01048"></a>01048                 }
<a name="l01049"></a>01049                 <span class="comment">// make a simple list</span>
<a name="l01050"></a>01050                 <span class="keywordflow">if</span> ($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;simpleList&#39;</span>]==1) {
<a name="l01051"></a>01051                         $rows = implode(<span class="charliteral">&#39;|&#39;</span>,$simpleRows);
<a name="l01052"></a>01052                         $array = t3lib_div::trimExplode(<span class="charliteral">&#39;|&#39;</span>,$rows,1);
<a name="l01053"></a>01053                         $rows = implode($this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;simpleListSeparator&#39;</span>],$array);
<a name="l01054"></a>01054                 }
<a name="l01055"></a>01055                 
<a name="l01056"></a>01056                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteSubpart($out,<span class="stringliteral">&#39;###rows###&#39;</span>,$rows);
<a name="l01057"></a>01057         }
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 
<a name="l01067"></a><a class="code" href="classx4epibase.html#a01e521ebe17734a191faad2124b10760">01067</a>         function <a class="code" href="classx4epibase.html#a01e521ebe17734a191faad2124b10760">singleView</a>(){
<a name="l01068"></a>01068                 global $TCA;
<a name="l01069"></a>01069                 <span class="keywordflow">if</span> (isset($this-&gt;piVars[<span class="stringliteral">&#39;showUid&#39;</span>])) {
<a name="l01070"></a>01070                         $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>] = $this-&gt;pi_getRecord($this-&gt;tableName,intval($this-&gt;piVars[<span class="stringliteral">&#39;showUid&#39;</span>]));
<a name="l01071"></a>01071                 }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073                 $this-&gt;<a class="code" href="classx4epibase.html#aeed34ca9ad6f09134194281dcd7b64b3">getLanguageOverlay</a>();
<a name="l01074"></a>01074 
<a name="l01075"></a>01075                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">template</span> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01076"></a>01076                         $this-&gt;<span class="keyword">template</span> = $this-&gt;cObj-&gt;fileResource($this-&gt;conf[<span class="stringliteral">&#39;detailView.&#39;</span>][<span class="stringliteral">&#39;template&#39;</span>]);
<a name="l01077"></a>01077                 }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079                 <span class="keywordflow">if</span> ($this-&gt;<span class="keyword">template</span> == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01080"></a>01080                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;No detail view template found&#39;</span>;
<a name="l01081"></a>01081                 }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083                 $tmpl = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###singleView###&#39;</span>);
<a name="l01084"></a>01084                 $this-&gt;completeTemplate = $this-&gt;<span class="keyword">template</span>;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086                 <span class="keywordflow">if</span> (isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]) &amp;&amp; ($this-&gt;conf[<span class="stringliteral">&#39;ignoreTypeTemplate&#39;</span>] != 1)) {
<a name="l01087"></a>01087                         $this-&gt;<span class="keyword">template</span> = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###type&#39;</span>.$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>]].<span class="stringliteral">&#39;Box###&#39;</span>);
<a name="l01088"></a>01088                 }
<a name="l01089"></a>01089 
<a name="l01090"></a>01090                 <span class="keywordflow">foreach</span>($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>] as $k=&gt;$v){
<a name="l01091"></a>01091                         $sub[<span class="stringliteral">&#39;###&#39;</span>.$k.<span class="stringliteral">&#39;Box###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#aabff2ca1e5cfeed50875f76187aa7fe7">getBoxedFieldContent</a>($k);
<a name="l01092"></a>01092                 }
<a name="l01093"></a>01093                 $mArr[<span class="stringliteral">&#39;###backLink###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a94846430495f3f87fe8a5becb9ca5a9e">getBackLink</a>();
<a name="l01094"></a>01094                 $mArr[<span class="stringliteral">&#39;###backLabel###&#39;</span>] = $this-&gt;pi_getLL(<span class="stringliteral">&#39;back&#39;</span>);
<a name="l01095"></a>01095                 <span class="keywordflow">if</span> ($this-&gt;conf[<span class="stringliteral">&#39;addTitleToPageTitle&#39;</span>]) {
<a name="l01096"></a>01096                         $GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;page[<span class="stringliteral">&#39;title&#39;</span>] .= <span class="stringliteral">&#39; - &#39;</span>.$this-&gt;internal[<span class="stringliteral">&#39;currentRow&#39;</span>][$TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>]];
<a name="l01097"></a>01097                 }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099                 <span class="keywordflow">if</span> (isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l01100"></a>01100                         $mArr[<span class="stringliteral">&#39;###content###&#39;</span>] = $this-&gt;cObj-&gt;substituteMarkerArrayCached($this-&gt;<span class="keyword">template</span>,array(),$sub);
<a name="l01101"></a>01101                 }
<a name="l01102"></a>01102                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArrayCached($tmpl,$mArr,$sub);
<a name="l01103"></a>01103         }
<a name="l01104"></a>01104 
<a name="l01110"></a><a class="code" href="classx4epibase.html#a94846430495f3f87fe8a5becb9ca5a9e">01110</a>         function <a class="code" href="classx4epibase.html#a94846430495f3f87fe8a5becb9ca5a9e">getBackLink</a>(){
<a name="l01111"></a>01111                 $id = $this-&gt;<a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>(<span class="stringliteral">&#39;listPageUid&#39;</span>);
<a name="l01112"></a>01112                 <span class="keywordflow">if</span> ($id == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01113"></a>01113                         $id = $this-&gt;piVars[<span class="stringliteral">&#39;back&#39;</span>];
<a name="l01114"></a>01114                         <span class="keywordflow">if</span> ($id == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01115"></a>01115                                 $id = $GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;id;
<a name="l01116"></a>01116                         }
<a name="l01117"></a>01117                 }
<a name="l01118"></a>01118                 <span class="keywordflow">return</span> $this-&gt;pi_linkTP_keepPIvars_url(array(<span class="stringliteral">&#39;showUid&#39;</span>=&gt;null,<span class="stringliteral">&#39;back&#39;</span>=&gt;null),1,0,$id);
<a name="l01119"></a>01119         }
<a name="l01120"></a>01120 
<a name="l01126"></a><a class="code" href="classx4epibase.html#a5110e3ff60e211bfa81d9c50cd4149ca">01126</a>         function <a class="code" href="classx4epibase.html#a5110e3ff60e211bfa81d9c50cd4149ca">pi_list_header</a>()       {
<a name="l01127"></a>01127                 $headT = $this-&gt;cObj-&gt;getSubpart($this-&gt;listT,<span class="stringliteral">&#39;###headRow###&#39;</span>);
<a name="l01128"></a>01128                 $cellT = $this-&gt;cObj-&gt;getSubpart($headT,<span class="stringliteral">&#39;###cell###&#39;</span>);
<a name="l01129"></a>01129                 $cells = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01130"></a>01130 
<a name="l01131"></a>01131                 <span class="keywordflow">foreach</span>($this-&gt;manualFieldOrder_list as $fieldName)     {
<a name="l01132"></a>01132                         $cells .= $this-&gt;cObj-&gt;substituteMarker($cellT,<span class="stringliteral">&#39;###content###&#39;</span>,$this-&gt;<a class="code" href="classx4epibase.html#a7a1567f5e81d2c0fed8277c35798b051">getFieldHeader_sortLink</a>($fieldName));
<a name="l01133"></a>01133                 }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteSubpart($headT,<span class="stringliteral">&#39;###cell###&#39;</span>,$cells);
<a name="l01136"></a>01136         }
<a name="l01137"></a>01137 
<a name="l01144"></a><a class="code" href="classx4epibase.html#a407a37fb3e999a439df8e45e7cc31800">01144</a>         function <a class="code" href="classx4epibase.html#a407a37fb3e999a439df8e45e7cc31800">pi_list_row</a>($c) {
<a name="l01145"></a>01145                 $cells = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01146"></a>01146                 $this-&gt;<a class="code" href="classx4epibase.html#aeed34ca9ad6f09134194281dcd7b64b3">getLanguageOverlay</a>();
<a name="l01147"></a>01147                 <span class="keywordflow">foreach</span>($this-&gt;manualFieldOrder_list as $fieldName)     {
<a name="l01148"></a>01148                         <span class="comment">// add either link of field-value-only</span>
<a name="l01149"></a>01149                         $mArr[<span class="stringliteral">&#39;###class###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01150"></a>01150                         <span class="keywordflow">if</span> ($this-&gt;conf[<span class="stringliteral">&#39;columnClasses.&#39;</span>][$fieldName] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01151"></a>01151                                 $mArr[<span class="stringliteral">&#39;###class###&#39;</span>] = <span class="stringliteral">&#39;class=&quot;&#39;</span>.$this-&gt;conf[<span class="stringliteral">&#39;columnClasses.&#39;</span>][$fieldName].<span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l01152"></a>01152                         }
<a name="l01153"></a>01153                         <span class="keywordflow">if</span> (in_array($fieldName,$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;detailLinkFields&#39;</span>])) {
<a name="l01154"></a>01154                                 $mArr[<span class="stringliteral">&#39;###content###&#39;</span>] = $this-&gt;pi_list_linkSingle($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fieldName],$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>],<span class="keyword">true</span>,$this-&gt;piVars,<span class="keyword">false</span>,$this-&gt;conf[<span class="stringliteral">&#39;listView.&#39;</span>][<span class="stringliteral">&#39;detailPageUid&#39;</span>]);
<a name="l01155"></a>01155                         } <span class="keywordflow">else</span> {
<a name="l01156"></a>01156                                 $mArr[<span class="stringliteral">&#39;###content###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a3f4d4db77e67041cf407532bffbd959f">getFieldContent</a>($fieldName);
<a name="l01157"></a>01157                         }
<a name="l01158"></a>01158                         $cells .= $this-&gt;cObj-&gt;substituteMarkerArray($this-&gt;cellT[$c%2],$mArr);
<a name="l01159"></a>01159                 }
<a name="l01160"></a>01160                 $this-&gt;<a class="code" href="classx4epibase.html#a169403114e8777380e8e4fb159e99fa7">addEditColumns</a>($cells,$mArr);
<a name="l01161"></a>01161                 $mArr[<span class="stringliteral">&#39;###uid###&#39;</span>] = $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>];
<a name="l01162"></a>01162                 $sub[<span class="stringliteral">&#39;###cell###&#39;</span>] = $cells;
<a name="l01163"></a>01163                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArrayCached($this-&gt;rowT[$c%2],$mArr,$sub);
<a name="l01164"></a>01164         }
<a name="l01165"></a>01165 
<a name="l01174"></a><a class="code" href="classx4epibase.html#a169403114e8777380e8e4fb159e99fa7">01174</a>         function <a class="code" href="classx4epibase.html#a169403114e8777380e8e4fb159e99fa7">addEditColumns</a>(&amp;$cells,&amp;$mArr) {
<a name="l01175"></a>01175                 <span class="keywordflow">if</span> ($this-&gt;conf[<span class="stringliteral">&#39;edit&#39;</span>]==1) {
<a name="l01176"></a>01176                         $mArr[<span class="stringliteral">&#39;###content###&#39;</span>] = $this-&gt;pi_linkTP($this-&gt;pi_getLL(<span class="stringliteral">&#39;edit&#39;</span>),array($this-&gt;prefixId.<span class="stringliteral">&#39;[editUid]&#39;</span>=&gt;$this-&gt;internal[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>], $this-&gt;prefixId.<span class="stringliteral">&#39;[action]&#39;</span>=&gt;<span class="stringliteral">&#39;edit&#39;</span>));
<a name="l01177"></a>01177                         $cells .= $this-&gt;cObj-&gt;substituteMarkerArray($this-&gt;cellT[$c%2],$mArr);
<a name="l01178"></a>01178                         $mArr[<span class="stringliteral">&#39;###content###&#39;</span>] = $this-&gt;pi_linkTP(html_entity_decode(utf8_encode($this-&gt;pi_getLL(<span class="stringliteral">&#39;remove&#39;</span>))),array($this-&gt;prefixId.<span class="stringliteral">&#39;[editUid]&#39;</span>=&gt;$this-&gt;internal[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>], $this-&gt;prefixId.<span class="stringliteral">&#39;[action]&#39;</span>=&gt;<span class="stringliteral">&#39;del&#39;</span>));
<a name="l01179"></a>01179                         $cells .= $this-&gt;cObj-&gt;substituteMarkerArray($this-&gt;cellT[$c%2],$mArr);
<a name="l01180"></a>01180                 }
<a name="l01181"></a>01181         }
<a name="l01182"></a>01182         
<a name="l01190"></a><a class="code" href="classx4epibase.html#a777911bc267d8f01207a10197b343191">01190</a>         function <a class="code" href="classx4epibase.html#a777911bc267d8f01207a10197b343191">pi_list_searchBox</a>($tableParams=<span class="stringliteral">&#39;&#39;</span>)     {
<a name="l01191"></a>01191                         <span class="comment">// Search box design:</span>
<a name="l01192"></a>01192                 $mArr[<span class="stringliteral">&#39;###formAction###&#39;</span>] = $this-&gt;pi_getPageLink($GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;<span class="keywordtype">id</span>);
<a name="l01193"></a>01193                 $mArr[<span class="stringliteral">&#39;###searchWord###&#39;</span>] = $this-&gt;piVars[<span class="stringliteral">&#39;sword&#39;</span>];
<a name="l01194"></a>01194                 $mArr[<span class="stringliteral">&#39;###submit###&#39;</span>] = $this-&gt;pi_getLL(<span class="stringliteral">&#39;pi_list_searchBox_search&#39;</span>,<span class="stringliteral">&#39;Search&#39;</span>,TRUE);
<a name="l01195"></a>01195                 $mArr[<span class="stringliteral">&#39;###extKey###&#39;</span>] = $this-&gt;prefixId;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197                 $tmpl = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###searchBox###&#39;</span>);
<a name="l01198"></a>01198 
<a name="l01199"></a>01199                 global $TCA;
<a name="l01200"></a>01200                 <span class="keywordflow">if</span> (isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>])){
<a name="l01201"></a>01201                         <span class="keywordflow">foreach</span>($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>] as $key =&gt; $col) {
<a name="l01202"></a>01202                                 <span class="keywordflow">if</span>(isset($col[<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;foreign_table&#39;</span>]) &amp;&amp; (strpos($tmpl,<span class="stringliteral">&#39;###search&#39;</span>.$key.<span class="stringliteral">&#39;###&#39;</span>) !== <span class="keyword">false</span>)) {
<a name="l01203"></a>01203                                         $mArr[<span class="stringliteral">&#39;###search&#39;</span>.$key.<span class="stringliteral">&#39;###&#39;</span>] = $this-&gt;<a class="code" href="classx4epibase.html#a7a5d0899770e7708cf47ca41388a9721">generateOptionsFromTable</a>(<span class="stringliteral">&#39;&lt;option value=&quot;###value###&quot; ###selected###&gt;###label###&lt;/option&gt;&#39;</span>,$col[<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;foreign_table&#39;</span>],$this-&gt;piVars[$key],<span class="keyword">true</span>);
<a name="l01204"></a>01204                                 }
<a name="l01205"></a>01205                         }
<a name="l01206"></a>01206                 }
<a name="l01207"></a>01207                 $mArr[<span class="stringliteral">&#39;###prefixId###&#39;</span>] = $this-&gt;prefixId;
<a name="l01208"></a>01208                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArray($tmpl,$mArr);
<a name="l01209"></a>01209         }
<a name="l01210"></a>01210 
<a name="l01217"></a><a class="code" href="classx4epibase.html#a7a1567f5e81d2c0fed8277c35798b051">01217</a>         function <a class="code" href="classx4epibase.html#a7a1567f5e81d2c0fed8277c35798b051">getFieldHeader_sortLink</a>($fN)   {
<a name="l01218"></a>01218                 <span class="keywordflow">return</span> $this-&gt;pi_linkTP_keepPIvars($this-&gt;<a class="code" href="classx4epibase.html#a4dda6200b65a955385b12f80f24f9e7c">getFieldHeader</a>($fN),array(<span class="stringliteral">&#39;sort&#39;</span>=&gt;$fN.<span class="charliteral">&#39;:&#39;</span>.($this-&gt;internal[<span class="stringliteral">&#39;descFlag&#39;</span>]?0:1)));
<a name="l01219"></a>01219         }
<a name="l01220"></a>01220 
<a name="l01229"></a><a class="code" href="classx4epibase.html#a4dda6200b65a955385b12f80f24f9e7c">01229</a>         function <a class="code" href="classx4epibase.html#a4dda6200b65a955385b12f80f24f9e7c">getFieldHeader</a>($fN) {
<a name="l01230"></a>01230                 <span class="keywordflow">if</span> (isset($this-&gt;conf[<span class="stringliteral">&#39;overrideLabels.&#39;</span>][$fN])) {
<a name="l01231"></a>01231                         <span class="keywordflow">return</span> $this-&gt;conf[<span class="stringliteral">&#39;overrideLabels.&#39;</span>][$fN];
<a name="l01232"></a>01232                 } <span class="keywordflow">else</span> {
<a name="l01233"></a>01233                         <span class="keywordflow">switch</span>($fN) {
<a name="l01234"></a>01234                                 <span class="keywordflow">default</span>:
<a name="l01235"></a>01235                                         <span class="keywordflow">return</span> $this-&gt;pi_getLL(<span class="stringliteral">&#39;listFieldHeader_&#39;</span>.$fN,<span class="charliteral">&#39;[&#39;</span>.$fN.<span class="charliteral">&#39;]&#39;</span>,1);
<a name="l01236"></a>01236                                 <span class="keywordflow">break</span>;
<a name="l01237"></a>01237                         }
<a name="l01238"></a>01238                 }
<a name="l01239"></a>01239         }
<a name="l01240"></a>01240 
<a name="l01247"></a><a class="code" href="classx4epibase.html#aabff2ca1e5cfeed50875f76187aa7fe7">01247</a>         function <a class="code" href="classx4epibase.html#aabff2ca1e5cfeed50875f76187aa7fe7">getBoxedFieldContent</a>($fN){
<a name="l01248"></a>01248                 $tmpl = $this-&gt;cObj-&gt;getSubpart($this-&gt;<span class="keyword">template</span>,<span class="stringliteral">&#39;###&#39;</span>.$fN.<span class="stringliteral">&#39;Box###&#39;</span>);
<a name="l01249"></a>01249                 <span class="keywordflow">if</span> (($tmpl != <span class="stringliteral">&#39;&#39;</span>) &amp;&amp; ($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$fN]!=<span class="stringliteral">&#39;&#39;</span>) &amp;&amp; $this-&gt;<a class="code" href="classx4epibase.html#a719e9bcaa0a94d6ab4f676f671ebbe10">checkDisplayField</a>($fN)) {
<a name="l01250"></a>01250                         $mArr[$fN] = $this-&gt;<a class="code" href="classx4epibase.html#a3f4d4db77e67041cf407532bffbd959f">getFieldContent</a>($fN);
<a name="l01251"></a>01251                         $mArr[$fN.<span class="stringliteral">&#39;Label&#39;</span>] = $this-&gt;pi_getLL($fN.<span class="stringliteral">&#39;Label&#39;</span>);
<a name="l01252"></a>01252                         <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarkerArray($tmpl,$mArr,<span class="stringliteral">&#39;###|###&#39;</span>);
<a name="l01253"></a>01253                 } <span class="keywordflow">else</span> {
<a name="l01254"></a>01254                         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l01255"></a>01255                 }
<a name="l01256"></a>01256         }
<a name="l01257"></a>01257 
<a name="l01264"></a><a class="code" href="classx4epibase.html#a719e9bcaa0a94d6ab4f676f671ebbe10">01264</a>         function <a class="code" href="classx4epibase.html#a719e9bcaa0a94d6ab4f676f671ebbe10">checkDisplayField</a>($fN) {
<a name="l01265"></a>01265                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01266"></a>01266         }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268 
<a name="l01282"></a><a class="code" href="classx4epibase.html#a6f4ae146a0d776b849007782657770bd">01282</a>         function <a class="code" href="classx4epibase.html#a6f4ae146a0d776b849007782657770bd">noResultFound</a>() {
<a name="l01283"></a>01283                 <span class="keywordflow">return</span> $this-&gt;cObj-&gt;substituteMarker($this-&gt;cObj-&gt;getSubpart($this-&gt;template,<span class="stringliteral">&#39;###noResultFoundBox###&#39;</span>),<span class="stringliteral">&#39;###noResultFoundText###&#39;</span>,$this-&gt;pi_getLL(<span class="stringliteral">&#39;noResultFound&#39;</span>));
<a name="l01284"></a>01284         }
<a name="l01285"></a>01285 
<a name="l01292"></a><a class="code" href="classx4epibase.html#a2d6209d9ffc5b800fb6011cbf73b1e7f">01292</a>         function <a class="code" href="classx4epibase.html#a2d6209d9ffc5b800fb6011cbf73b1e7f">createRecord</a>($values) {
<a name="l01293"></a>01293                 $ins[<span class="stringliteral">&#39;tstamp&#39;</span>] = $ins[<span class="stringliteral">&#39;crdate&#39;</span>] = time();
<a name="l01294"></a>01294                 <span class="keywordflow">foreach</span>($values as $k =&gt; $v) {
<a name="l01295"></a>01295                         $ins[$k] = mysql_real_escape_string($v);
<a name="l01296"></a>01296                 }
<a name="l01297"></a>01297                 $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_INSERTquery($this-&gt;tableName,$ins);
<a name="l01298"></a>01298         }
<a name="l01299"></a>01299 
<a name="l01307"></a><a class="code" href="classx4epibase.html#afd11afedd7c41118f9c8481d6ef0a504">01307</a>         function <a class="code" href="classx4epibase.html#afd11afedd7c41118f9c8481d6ef0a504">updateRecord</a>($values,$uid) {
<a name="l01308"></a>01308                 $ins[<span class="stringliteral">&#39;tstamp&#39;</span>] = time();
<a name="l01309"></a>01309                 <span class="keywordflow">foreach</span>($values as $k =&gt; $v) {
<a name="l01310"></a>01310                         $ins[$k] = mysql_real_escape_string($v);
<a name="l01311"></a>01311                 }
<a name="l01312"></a>01312                 $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_UPDATEquery($this-&gt;tableName,<span class="stringliteral">&#39;uid=&#39;</span>.intval($uid),$ins);
<a name="l01313"></a>01313         }
<a name="l01314"></a>01314 
<a name="l01321"></a><a class="code" href="classx4epibase.html#a978f2e3be788bfa27b0be25afefe2f76">01321</a>         function <a class="code" href="classx4epibase.html#a978f2e3be788bfa27b0be25afefe2f76">deleteRecord</a>($uid) {
<a name="l01322"></a>01322                 $v[<span class="stringliteral">&#39;deleted&#39;</span>]=1;
<a name="l01323"></a>01323                 $this-&gt;<a class="code" href="classx4epibase.html#afd11afedd7c41118f9c8481d6ef0a504">updateRecord</a>($v,$uid);
<a name="l01324"></a>01324         }
<a name="l01325"></a>01325 
<a name="l01333"></a><a class="code" href="classx4epibase.html#a10cb39ec32fcca95159a26d1543f9f7e">01333</a>         function <a class="code" href="classx4epibase.html#a10cb39ec32fcca95159a26d1543f9f7e">clearCache</a>($cacheCmd=0) {
<a name="l01334"></a>01334                 <span class="keywordflow">if</span> ($cacheCmd != 0) {
<a name="l01335"></a>01335                         require_once(PATH_t3lib.<span class="stringliteral">&#39;class.t3lib_tcemain.php&#39;</span>);
<a name="l01336"></a>01336                         t3lib_TCEmain::clear_cacheCmd($cacheCmd);
<a name="l01337"></a>01337                 }
<a name="l01338"></a>01338         }
<a name="l01339"></a>01339 
<a name="l01350"></a><a class="code" href="classx4epibase.html#a5ad1a5d0c31197691b159fc99fb9bcfc">01350</a>         function <a class="code" href="classx4epibase.html#a5ad1a5d0c31197691b159fc99fb9bcfc">generateCountryOptions</a>($selected=<span class="stringliteral">&#39;&#39;</span>,$addEmpty=<span class="keyword">false</span>,$EUonly =<span class="keyword">true</span>) {
<a name="l01351"></a>01351                 <span class="keywordflow">if</span> ($EUonly) {
<a name="l01352"></a>01352                         $addWhere = <span class="stringliteral">&#39; AND (cn_eu_member = 1 OR uid = 41)&#39;</span>;
<a name="l01353"></a>01353                 }
<a name="l01354"></a>01354                 <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classx4epibase.html#a7a5d0899770e7708cf47ca41388a9721">generateOptionsFromTable</a>(<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;static_countries&#39;</span>,$selected,$addEmpty,<span class="stringliteral">&#39;cn_short_de&#39;</span>,<span class="stringliteral">&#39;cn_short_de&#39;</span>,$addWhere,<span class="stringliteral">&#39;cn_short_de&#39;</span>);
<a name="l01355"></a>01355         }
<a name="l01356"></a>01356 
<a name="l01366"></a><a class="code" href="classx4epibase.html#a7a5d0899770e7708cf47ca41388a9721">01366</a>     function <a class="code" href="classx4epibase.html#a7a5d0899770e7708cf47ca41388a9721">generateOptionsFromTable</a>($tmpl,<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>,$selected=<span class="stringliteral">&#39;&#39;</span>,$addEmpty=<span class="keyword">false</span>, $labelKey=<span class="stringliteral">&#39;&#39;</span>, $valueKey=<span class="stringliteral">&#39;&#39;</span>, $addWhere=<span class="stringliteral">&#39;&#39;</span>,$orderBy=<span class="stringliteral">&#39;&#39;</span>,$labelAlias=<span class="stringliteral">&#39;&#39;</span>) {
<a name="l01367"></a>01367         <span class="keywordflow">if</span>($tmpl == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01368"></a>01368                 $tmpl = <span class="stringliteral">&#39;&lt;option value=&quot;###value###&quot; ###selected###&gt;###label###&lt;/option&gt;&#39;</span>;
<a name="l01369"></a>01369         }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371         <span class="comment">// get correct sql statement</span>
<a name="l01372"></a>01372         global $TCA;
<a name="l01373"></a>01373         <span class="keywordflow">if</span> ($labelKey==<span class="stringliteral">&#39;&#39;</span>) {
<a name="l01374"></a>01374                 $labelKey = $TCA[<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>];
<a name="l01375"></a>01375         }
<a name="l01376"></a>01376                 
<a name="l01377"></a>01377                 <span class="keywordflow">if</span>($labelAlias == <span class="stringliteral">&#39;&#39;</span>){
<a name="l01378"></a>01378                 $labelAlias = $labelKey;
<a name="l01379"></a>01379         }
<a name="l01380"></a>01380                 
<a name="l01381"></a>01381         <span class="keywordflow">if</span> ($valueKey == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01382"></a>01382                 $valueKey = <span class="stringliteral">&#39;uid&#39;</span>;
<a name="l01383"></a>01383         }
<a name="l01384"></a>01384         $fields = $valueKey.<span class="charliteral">&#39;,&#39;</span>.$labelKey;
<a name="l01385"></a>01385 
<a name="l01386"></a>01386         <span class="keywordflow">if</span> ($valueKey != <span class="stringliteral">&#39;uid&#39;</span>) {
<a name="l01387"></a>01387                 $fields .=<span class="stringliteral">&#39;, uid&#39;</span>;
<a name="l01388"></a>01388         }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390         $where = <span class="stringliteral">&#39;1 &#39;</span>.$this-&gt;cObj-&gt;enableFields(<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>).$addWhere;
<a name="l01391"></a>01391 
<a name="l01392"></a>01392         <span class="keywordflow">if</span> ($orderBy == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01393"></a>01393                 $orderBy = $TCA[<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;sortby&#39;</span>];
<a name="l01394"></a>01394         }
<a name="l01395"></a>01395                         
<a name="l01396"></a>01396         <span class="comment">// run statement</span>
<a name="l01397"></a>01397         $opts = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECTquery($fields,<a class="code" href="classx4epibase.html#aea06aaf672e3fe5fbf45958ae2782244">$tableName</a>,$where,<span class="stringliteral">&#39;&#39;</span>,$orderBy);
<a name="l01398"></a>01398         <span class="comment">// free variables</span>
<a name="l01399"></a>01399         unset($fields,$where,$orderBy);
<a name="l01400"></a>01400 
<a name="l01401"></a>01401         <span class="comment">// loop the result</span>
<a name="l01402"></a>01402         <span class="keywordflow">while</span> ($opt = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;sql_fetch_assoc($opts)) {
<a name="l01403"></a>01403 
<a name="l01404"></a>01404                 $mArr[<span class="stringliteral">&#39;###label###&#39;</span>] = $opt[$labelAlias];
<a name="l01405"></a>01405                 $mArr[<span class="stringliteral">&#39;###value###&#39;</span>] = $opt[$valueKey];
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                 <span class="keywordflow">if</span> ($opt[<span class="stringliteral">&#39;uid&#39;</span>] == $selected) {
<a name="l01408"></a>01408                         $mArr[<span class="stringliteral">&#39;###selected###&#39;</span>] = <span class="stringliteral">&#39;selected=&quot;selected&quot;&#39;</span>;
<a name="l01409"></a>01409                         $chosen = <span class="keyword">true</span>;
<a name="l01410"></a>01410                 } <span class="keywordflow">else</span> {
<a name="l01411"></a>01411                         $mArr[<span class="stringliteral">&#39;###selected###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01412"></a>01412                 }
<a name="l01413"></a>01413                 $returnStr .= $this-&gt;cObj-&gt;substituteMarkerArray($tmpl,$mArr);
<a name="l01414"></a>01414         }
<a name="l01415"></a>01415 
<a name="l01416"></a>01416         <span class="comment">// Add empty elment at the beginning, and select if no other element is selected</span>
<a name="l01417"></a>01417         <span class="keywordflow">if</span> ($addEmpty) {
<a name="l01418"></a>01418                 $mArr[<span class="stringliteral">&#39;###label###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01419"></a>01419                 $mArr[<span class="stringliteral">&#39;###value###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01420"></a>01420                 <span class="keywordflow">if</span> (!$chosen) {
<a name="l01421"></a>01421                         $mArr[<span class="stringliteral">&#39;###selected###&#39;</span>] = <span class="stringliteral">&#39;selected=&quot;selected&quot;&#39;</span>;
<a name="l01422"></a>01422                 } <span class="keywordflow">else</span> {
<a name="l01423"></a>01423                         $mArr[<span class="stringliteral">&#39;###selected###&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01424"></a>01424                 }
<a name="l01425"></a>01425                 $returnStr = $this-&gt;cObj-&gt;substituteMarkerArray($tmpl,$mArr).$returnStr;
<a name="l01426"></a>01426         }
<a name="l01427"></a>01427         <span class="keywordflow">return</span> $returnStr;
<a name="l01428"></a>01428     }
<a name="l01429"></a>01429 
<a name="l01436"></a><a class="code" href="classx4epibase.html#aa2ee48cf5b4af83b39611fa42636fbf5">01436</a>     function <a class="code" href="classx4epibase.html#aa2ee48cf5b4af83b39611fa42636fbf5">addfValidate</a>() {
<a name="l01437"></a>01437         $GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;additionalHeaderData[$this-&gt;extKey].=<span class="stringliteral">&#39;</span>
<a name="l01438"></a>01438 <span class="stringliteral">                                &lt;script type=&quot;text/javascript&quot; src=&quot;typo3conf/ext/x4epibase/fValidate/fValidate.config.js&quot;&gt;&lt;/script&gt;</span>
<a name="l01439"></a>01439 <span class="stringliteral">                                &lt;script type=&quot;text/javascript&quot; src=&quot;typo3conf/ext/x4epibase/fValidate/fValidate.core.js&quot;&gt;&lt;/script&gt;</span>
<a name="l01440"></a>01440 <span class="stringliteral">                                &lt;script type=&quot;text/javascript&quot; src=&quot;typo3conf/ext/x4epibase/fValidate/fValidate.lang-enUS.js&quot;&gt;&lt;/script&gt;</span>
<a name="l01441"></a>01441 <span class="stringliteral">                                &lt;script type=&quot;text/javascript&quot; src=&quot;typo3conf/ext/x4epibase/fValidate/fValidate.validators.js&quot;&gt;&lt;/script&gt;</span>
<a name="l01442"></a>01442 <span class="stringliteral">                                &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;</span>
<a name="l01443"></a>01443 <span class="stringliteral">                                        var dontValidate = false;</span>
<a name="l01444"></a>01444 <span class="stringliteral">                                &lt;/script&gt;</span>
<a name="l01445"></a>01445 <span class="stringliteral">                                &lt;style type=&quot;text/css&quot;&gt;</span>
<a name="l01446"></a>01446 <span class="stringliteral">                                        .errHilite {</span>
<a name="l01447"></a>01447 <span class="stringliteral">                                                color: #ff0000;</span>
<a name="l01448"></a>01448 <span class="stringliteral">                                        }</span>
<a name="l01449"></a>01449 <span class="stringliteral">                                        input.errHilite {</span>
<a name="l01450"></a>01450 <span class="stringliteral">                                                background-color: #cccccc;</span>
<a name="l01451"></a>01451 <span class="stringliteral">                                                color: black;</span>
<a name="l01452"></a>01452 <span class="stringliteral">                                        }</span>
<a name="l01453"></a>01453 <span class="stringliteral">                                &lt;/style&gt;</span>
<a name="l01454"></a>01454 <span class="stringliteral">                                &#39;</span>;
<a name="l01455"></a>01455     }
<a name="l01456"></a>01456 
<a name="l01463"></a><a class="code" href="classx4epibase.html#aa5b8c1ae9271737c37061688c0157b6a">01463</a>     function <a class="code" href="classx4epibase.html#aa5b8c1ae9271737c37061688c0157b6a">addJSValidation</a>($formId) {
<a name="l01464"></a>01464         $GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;additionalHeaderData[$this-&gt;extKey].=<span class="stringliteral">&#39;</span>
<a name="l01465"></a>01465 <span class="stringliteral">                                &lt;script type=&quot;text/javascript&quot; src=&quot;typo3conf/ext/x4epibase/js/validation.js&quot;&gt;&lt;/script&gt;&#39;</span>;
<a name="l01466"></a>01466         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;</span>
<a name="l01467"></a>01467 <span class="stringliteral">                                new Validation(&quot;&#39;</span>.$formId.<span class="stringliteral">&#39;&quot;);</span>
<a name="l01468"></a>01468 <span class="stringliteral">                                &lt;/script&gt;&#39;</span>;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470     }
<a name="l01471"></a>01471 
<a name="l01477"></a><a class="code" href="classx4epibase.html#a51f7d5c0365daa10736993065d5f08fa">01477</a>         function <a class="code" href="classx4epibase.html#a51f7d5c0365daa10736993065d5f08fa">formatFilesize</a>($size){
<a name="l01478"></a>01478                   $i=0;
<a name="l01479"></a>01479                   $iec = array(<span class="stringliteral">&quot;B&quot;</span>, <span class="stringliteral">&quot;KB&quot;</span>, <span class="stringliteral">&quot;MB&quot;</span>, <span class="stringliteral">&quot;GB&quot;</span>, <span class="stringliteral">&quot;TB&quot;</span>, <span class="stringliteral">&quot;PB&quot;</span>, <span class="stringliteral">&quot;EB&quot;</span>, <span class="stringliteral">&quot;ZB&quot;</span>, <span class="stringliteral">&quot;YB&quot;</span>);
<a name="l01480"></a>01480                   <span class="keywordflow">while</span> (($size/1024)&gt;1) {
<a name="l01481"></a>01481                    $size=$size/1024;
<a name="l01482"></a>01482                    $i++;
<a name="l01483"></a>01483                   }
<a name="l01484"></a>01484                   <span class="keywordflow">return</span> round($size,1).<span class="charliteral">&#39; &#39;</span>.$iec[$i];
<a name="l01485"></a>01485         }
<a name="l01486"></a>01486 
<a name="l01493"></a><a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">01493</a>         function <a class="code" href="classx4epibase.html#aaa65bbd9e22cdee6c468f375c4ffd552">getTSFFvar</a>($varName,$page=<span class="stringliteral">&#39;sDEF&#39;</span>) {
<a name="l01494"></a>01494                 <span class="keywordflow">if</span> ($this-&gt;pi_getFFvalue($this-&gt;cObj-&gt;data[<span class="stringliteral">&#39;pi_flexform&#39;</span>],$varName,$page) != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01495"></a>01495                     <span class="keywordflow">return</span> $this-&gt;pi_getFFvalue($this-&gt;cObj-&gt;data[<span class="stringliteral">&#39;pi_flexform&#39;</span>],$varName,$page);
<a name="l01496"></a>01496                 } <span class="keywordflow">else</span> {
<a name="l01497"></a>01497                         <span class="keywordflow">return</span> $this-&gt;conf[$varName];
<a name="l01498"></a>01498                 }
<a name="l01499"></a>01499         }
<a name="l01500"></a>01500 
<a name="l01501"></a>01501 
<a name="l01509"></a><a class="code" href="classx4epibase.html#aecb86e6e8605aaaa723826cab50831ed">01509</a>         function <a class="code" href="classx4epibase.html#aecb86e6e8605aaaa723826cab50831ed">websafeFilename</a>($text) {
<a name="l01510"></a>01510                 $text = str_replace(<span class="stringliteral">&#39;ä&#39;</span>,<span class="stringliteral">&#39;ae&#39;</span>,$text);
<a name="l01511"></a>01511                 $text = str_replace(<span class="stringliteral">&#39;ö&#39;</span>,<span class="stringliteral">&#39;oe&#39;</span>,$text);
<a name="l01512"></a>01512                 $text = str_replace(<span class="stringliteral">&#39;ü&#39;</span>,<span class="stringliteral">&#39;ue&#39;</span>,$text);
<a name="l01513"></a>01513                 $text = str_replace(<span class="stringliteral">&#39;Ä&#39;</span>,<span class="stringliteral">&#39;Ae&#39;</span>,$text);
<a name="l01514"></a>01514                 $text = str_replace(<span class="stringliteral">&#39;Ö&#39;</span>,<span class="stringliteral">&#39;Oe&#39;</span>,$text);
<a name="l01515"></a>01515                 $text = str_replace(<span class="stringliteral">&#39;Ü&#39;</span>,<span class="stringliteral">&#39;Ue&#39;</span>,$text);
<a name="l01516"></a>01516                 $text = str_replace(<span class="charliteral">&#39; &#39;</span>,<span class="charliteral">&#39;_&#39;</span>,$text);
<a name="l01517"></a>01517 
<a name="l01518"></a>01518                 <span class="keywordflow">return</span> preg_replace(<span class="stringliteral">&quot;/[^a-zA-Z0-9\-_\.]+/&quot;</span>, <span class="stringliteral">&quot;_&quot;</span>, $text);
<a name="l01519"></a>01519         }
<a name="l01520"></a>01520 
<a name="l01538"></a><a class="code" href="classx4epibase.html#a5f679afda454b41ae5977b61c31ca16a">01538</a>         function <a class="code" href="classx4epibase.html#a5f679afda454b41ae5977b61c31ca16a">pi_list_query</a>($table,$count=0,$addWhere=<span class="stringliteral">&#39;&#39;</span>,$mm_cat=<span class="stringliteral">&#39;&#39;</span>,$groupBy=<span class="stringliteral">&#39;&#39;</span>,$orderBy=<span class="stringliteral">&#39;&#39;</span>,$query=<span class="stringliteral">&#39;&#39;</span>,$returnQueryArray=FALSE)       {
<a name="l01539"></a>01539                         <span class="comment">// Begin Query:</span>
<a name="l01540"></a>01540                         
<a name="l01541"></a>01541                 <span class="keywordflow">if</span>(isset($this-&gt;conf[<span class="stringliteral">&#39;includeHiddenRecords&#39;</span>])){
<a name="l01542"></a>01542                         $hidden = $this-&gt;conf[<span class="stringliteral">&#39;includeHiddenRecords&#39;</span>];
<a name="l01543"></a>01543                 } <span class="keywordflow">else</span> {
<a name="l01544"></a>01544                         $hidden = 0;
<a name="l01545"></a>01545                 }
<a name="l01546"></a>01546 
<a name="l01547"></a>01547                 <span class="keywordflow">if</span> (!$query)    {
<a name="l01548"></a>01548                                 <span class="comment">// Fetches the list of PIDs to select from.</span>
<a name="l01549"></a>01549                                 <span class="comment">// TypoScript property .pidList is a comma list of pids. If blank, current page id is used.</span>
<a name="l01550"></a>01550 
<a name="l01551"></a>01551 
<a name="l01552"></a>01552                                 <span class="comment">// TypoScript property .recursive is a int+ which determines how many levels down from the pids in the pid-list subpages should be included in the select.</span>
<a name="l01553"></a>01553                         $pidList = $this-&gt;pi_getPidList($this-&gt;conf[<span class="stringliteral">&#39;pidList&#39;</span>],$this-&gt;conf[<span class="stringliteral">&#39;recursive&#39;</span>]);
<a name="l01554"></a>01554                         <span class="keywordflow">if</span> (is_array($mm_cat))  {
<a name="l01555"></a>01555                                 $query=<span class="stringliteral">&#39;FROM &#39;</span>.$table.<span class="charliteral">&#39;,&#39;</span>.$mm_cat[<span class="stringliteral">&#39;table&#39;</span>].<span class="charliteral">&#39;,&#39;</span>.$mm_cat[<span class="stringliteral">&#39;mmtable&#39;</span>].chr(10).
<a name="l01556"></a>01556                                                 <span class="stringliteral">&#39; WHERE &#39;</span>.$table.<span class="stringliteral">&#39;.uid=&#39;</span>.$mm_cat[<span class="stringliteral">&#39;mmtable&#39;</span>].<span class="stringliteral">&#39;.uid_local AND &#39;</span>.$mm_cat[<span class="stringliteral">&#39;table&#39;</span>].<span class="stringliteral">&#39;.uid=&#39;</span>.$mm_cat[<span class="stringliteral">&#39;mmtable&#39;</span>].<span class="stringliteral">&#39;.uid_foreign &#39;</span>.chr(10).
<a name="l01557"></a>01557                                                 (strcmp($mm_cat[<span class="stringliteral">&#39;catUidList&#39;</span>],<span class="stringliteral">&#39;&#39;</span>)?<span class="stringliteral">&#39; AND &#39;</span>.$mm_cat[<span class="stringliteral">&#39;table&#39;</span>].<span class="stringliteral">&#39;.uid IN (&#39;</span>.$mm_cat[<span class="stringliteral">&#39;catUidList&#39;</span>].<span class="charliteral">&#39;)&#39;</span>:<span class="stringliteral">&#39;&#39;</span>).chr(10).
<a name="l01558"></a>01558                                                 <span class="stringliteral">&#39; AND &#39;</span>.$table.<span class="stringliteral">&#39;.pid IN (&#39;</span>.$pidList.<span class="charliteral">&#39;)&#39;</span>.chr(10).
<a name="l01559"></a>01559                                 $this-&gt;cObj-&gt;enableFields($table,$hidden).chr(10);      <span class="comment">// This adds WHERE-clauses that ensures deleted, hidden, starttime/endtime/access records are NOT selected, if they should not! Almost ALWAYS add this to your queries!</span>
<a name="l01560"></a>01560                         } <span class="keywordflow">else</span> {
<a name="l01561"></a>01561                                 $query=<span class="stringliteral">&#39;FROM &#39;</span>.$table.<span class="stringliteral">&#39; WHERE &#39;</span>.$table.<span class="stringliteral">&#39;.pid IN (&#39;</span>.$pidList.<span class="charliteral">&#39;)&#39;</span>.chr(10).
<a name="l01562"></a>01562                                 $this-&gt;cObj-&gt;enableFields($table,$hidden).chr(10);      <span class="comment">// This adds WHERE-clauses that ensures deleted, hidden, starttime/endtime/access records are NOT selected, if they should not! Almost ALWAYS add this to your queries!</span>
<a name="l01563"></a>01563                         }
<a name="l01564"></a>01564                 }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566                         <span class="comment">// Split the &quot;FROM ... WHERE&quot; string so we get the WHERE part and TABLE names separated...:</span>
<a name="l01567"></a>01567 
<a name="l01568"></a>01568                 list($TABLENAMES,$WHERE) = spliti(<span class="stringliteral">&#39;WHERE&#39;</span>, trim($query), 2);
<a name="l01569"></a>01569                 $TABLENAMES = trim(substr(trim($TABLENAMES),5));
<a name="l01570"></a>01570                 $WHERE = trim($WHERE);
<a name="l01571"></a>01571 
<a name="l01572"></a>01572                         <span class="comment">// Add &#39;$addWhere&#39;</span>
<a name="l01573"></a>01573 
<a name="l01574"></a>01574                 <span class="keywordflow">if</span> ($addWhere)  {$WHERE.=<span class="charliteral">&#39; &#39;</span>.$addWhere.chr(10);}
<a name="l01575"></a>01575 
<a name="l01576"></a>01576                         <span class="comment">// Search word:</span>
<a name="l01577"></a>01577 
<a name="l01578"></a>01578                 <span class="keywordflow">if</span> ($this-&gt;piVars[<span class="stringliteral">&#39;sword&#39;</span>] &amp;&amp; $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;searchFieldList&#39;</span>])       {
<a name="l01579"></a>01579                         $WHERE.=$this-&gt;<a class="code" href="classx4epibase.html#a7e2bd694bf70c7ad0b54d9c7dc159a32">searchWhere</a>($this-&gt;piVars[<span class="stringliteral">&#39;sword&#39;</span>],$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;searchFieldList&#39;</span>],$table).chr(10);
<a name="l01580"></a>01580                 }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582                 <span class="keywordflow">if</span> ($count) {
<a name="l01583"></a>01583                         $queryParts = array(
<a name="l01584"></a>01584                                 <span class="stringliteral">&#39;SELECT&#39;</span> =&gt; <span class="stringliteral">&#39;count(*)&#39;</span>,
<a name="l01585"></a>01585                                 <span class="stringliteral">&#39;FROM&#39;</span> =&gt; $TABLENAMES,
<a name="l01586"></a>01586                                 <span class="stringliteral">&#39;WHERE&#39;</span> =&gt; $WHERE,
<a name="l01587"></a>01587                                 <span class="stringliteral">&#39;GROUPBY&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l01588"></a>01588                                 <span class="stringliteral">&#39;ORDERBY&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l01589"></a>01589                                 <span class="stringliteral">&#39;LIMIT&#39;</span> =&gt; <span class="stringliteral">&#39;&#39;</span>
<a name="l01590"></a>01590                         );
<a name="l01591"></a>01591                 } <span class="keywordflow">else</span> {
<a name="l01592"></a>01592                                 <span class="comment">// Order by data:</span>
<a name="l01593"></a>01593                         <span class="keywordflow">if</span> (!$orderBy &amp;&amp; $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>])    {
<a name="l01594"></a>01594                                 <span class="keywordflow">if</span> (t3lib_div::inList($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderByList&#39;</span>],$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>]))       {
<a name="l01595"></a>01595                                         $orderBy = <span class="stringliteral">&#39;ORDER BY &#39;</span>.$table.<span class="charliteral">&#39;.&#39;</span>.$this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;orderBy&#39;</span>].($this-&gt;internal[<span class="stringliteral">&#39;descFlag&#39;</span>]?<span class="stringliteral">&#39; DESC&#39;</span>:<span class="stringliteral">&#39;&#39;</span>);
<a name="l01596"></a>01596                                 }
<a name="l01597"></a>01597                         }
<a name="l01598"></a>01598 
<a name="l01599"></a>01599                                 <span class="comment">// Limit data:</span>
<a name="l01600"></a>01600                         $pointer = $this-&gt;piVars[<span class="stringliteral">&#39;pointer&#39;</span>];
<a name="l01601"></a>01601                         $pointer = intval($pointer);
<a name="l01602"></a>01602                         $results_at_a_time = t3lib_div::intInRange($this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;results_at_a_time&#39;</span>],1,1000);
<a name="l01603"></a>01603 
<a name="l01604"></a>01604                         $LIMIT = ($pointer*$results_at_a_time).<span class="charliteral">&#39;,&#39;</span>.$results_at_a_time;
<a name="l01605"></a>01605                                 <span class="comment">// Add &#39;SELECT&#39;</span>
<a name="l01606"></a>01606                         $queryParts = array(
<a name="l01607"></a>01607                                 <span class="stringliteral">&#39;SELECT&#39;</span> =&gt; $this-&gt;pi_prependFieldsWithTable($table,$this-&gt;pi_listFields),
<a name="l01608"></a>01608                                 <span class="stringliteral">&#39;FROM&#39;</span> =&gt; $TABLENAMES,
<a name="l01609"></a>01609                                 <span class="stringliteral">&#39;WHERE&#39;</span> =&gt; $WHERE,
<a name="l01610"></a>01610                                 <span class="stringliteral">&#39;GROUPBY&#39;</span> =&gt; $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;stripGroupBy($groupBy),
<a name="l01611"></a>01611                                 <span class="stringliteral">&#39;ORDERBY&#39;</span> =&gt; $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;stripOrderBy($orderBy),
<a name="l01612"></a>01612                                 <span class="stringliteral">&#39;LIMIT&#39;</span> =&gt; $LIMIT
<a name="l01613"></a>01613                         );
<a name="l01614"></a>01614                         
<a name="l01615"></a>01615                 }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617                 $query = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;SELECTquery (
<a name="l01618"></a>01618                                         $queryParts[<span class="stringliteral">&#39;SELECT&#39;</span>],
<a name="l01619"></a>01619                                         $queryParts[<span class="stringliteral">&#39;FROM&#39;</span>],
<a name="l01620"></a>01620                                         $queryParts[<span class="stringliteral">&#39;WHERE&#39;</span>],
<a name="l01621"></a>01621                                         $queryParts[<span class="stringliteral">&#39;GROUPBY&#39;</span>],
<a name="l01622"></a>01622                                         $queryParts[<span class="stringliteral">&#39;ORDERBY&#39;</span>],
<a name="l01623"></a>01623                                         $queryParts[<span class="stringliteral">&#39;LIMIT&#39;</span>]
<a name="l01624"></a>01624                                 );
<a name="l01625"></a>01625 
<a name="l01626"></a>01626                 <span class="keywordflow">return</span> $returnQueryArray ? $queryParts : $query;
<a name="l01627"></a>01627         }
<a name="l01628"></a>01628 
<a name="l01638"></a><a class="code" href="classx4epibase.html#a7e2bd694bf70c7ad0b54d9c7dc159a32">01638</a>         function <a class="code" href="classx4epibase.html#a7e2bd694bf70c7ad0b54d9c7dc159a32">searchWhere</a>($sw,$searchFieldList,$searchTable=<span class="stringliteral">&#39;&#39;</span>)      {
<a name="l01639"></a>01639                 global $TYPO3_DB,$TCA;
<a name="l01640"></a>01640                 $prefixTableName = $searchTable ? $searchTable.<span class="charliteral">&#39;.&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l01641"></a>01641                 $where = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01642"></a>01642                 <span class="keywordflow">if</span> ($sw)        {
<a name="l01643"></a>01643                         $searchFields = t3lib_div::trimExplode(<span class="charliteral">&#39;,&#39;</span>,$searchFieldList,1);
<a name="l01644"></a>01644                         $kw = split(<span class="stringliteral">&#39;[ ,]&#39;</span>,$sw);
<a name="l01645"></a>01645 
<a name="l01646"></a>01646                         <span class="keywordflow">while</span>(list(,$val)=each($kw))    {
<a name="l01647"></a>01647                                 $val = trim($val);
<a name="l01648"></a>01648                                 $where_p = array();
<a name="l01649"></a>01649                                 <span class="keywordflow">if</span> (strlen($val)&gt;=2)    {
<a name="l01650"></a>01650                                         $val = $TYPO3_DB-&gt;escapeStrForLike($TYPO3_DB-&gt;quoteStr($val,$searchTable),$searchTable);
<a name="l01651"></a>01651                                         reset($searchFields);
<a name="l01652"></a>01652                                         <span class="keywordflow">while</span>(list(,$field)=each($searchFields))        {
<a name="l01653"></a>01653                                                 <span class="keywordflow">if</span> (isset($TCA[$searchTable][<span class="stringliteral">&#39;columns&#39;</span>][$field][<span class="stringliteral">&#39;config&#39;</span>][<span class="stringliteral">&#39;MM&#39;</span>])) {
<a name="l01654"></a>01654                                                         $where_p[] = $this-&gt;<a class="code" href="classx4epibase.html#a19590e2444fd145167f62a2633fa2b9b">searchWhereMM</a>($sw,$field);
<a name="l01655"></a>01655                                                 } <span class="keywordflow">else</span> {
<a name="l01656"></a>01656                                                         $where_p[] = $prefixTableName.$field.<span class="stringliteral">&#39; LIKE \&#39;%&#39;</span>.$val.<span class="stringliteral">&#39;%\&#39;&#39;</span>;
<a name="l01657"></a>01657                                                 }
<a name="l01658"></a>01658                                         }
<a name="l01659"></a>01659                                 }
<a name="l01660"></a>01660 
<a name="l01661"></a>01661                                 <span class="keywordflow">if</span> (count($where_p))    {
<a name="l01662"></a>01662                                         $where.=<span class="stringliteral">&#39; AND (&#39;</span>.implode(<span class="stringliteral">&#39; OR &#39;</span>,$where_p).<span class="charliteral">&#39;)&#39;</span>;
<a name="l01663"></a>01663                                 }
<a name="l01664"></a>01664                         }
<a name="l01665"></a>01665                 }
<a name="l01666"></a>01666                 <span class="keywordflow">return</span> $where;
<a name="l01667"></a>01667         }
<a name="l01668"></a>01668 
<a name="l01669"></a>01669 
<a name="l01678"></a><a class="code" href="classx4epibase.html#a19590e2444fd145167f62a2633fa2b9b">01678</a>         function <a class="code" href="classx4epibase.html#a19590e2444fd145167f62a2633fa2b9b">searchWhereMM</a>($sw,$fieldName) {
<a name="l01679"></a>01679                 global $TCA;
<a name="l01680"></a>01680 
<a name="l01681"></a>01681                 $conf = $TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>][$fieldName][<span class="stringliteral">&#39;config&#39;</span>];
<a name="l01682"></a>01682 
<a name="l01683"></a>01683                 $table = $conf[<span class="stringliteral">&#39;foreign_table&#39;</span>];
<a name="l01684"></a>01684                 $fQuery = $this-&gt;cObj-&gt;searchWhere($this-&gt;piVars[<span class="stringliteral">&#39;sword&#39;</span>],$TCA[$table][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;label&#39;</span>],$table);
<a name="l01685"></a>01685                 $sql = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;SELECTquery(<span class="stringliteral">&#39;uid&#39;</span>,$table,<span class="stringliteral">&#39;1 &#39;</span>.$fQuery.$this-&gt;cObj-&gt;enableFields($table));
<a name="l01686"></a>01686                 $sql = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;SELECTquery(<span class="stringliteral">&#39;uid_local&#39;</span>,$conf[<span class="stringliteral">&#39;MM&#39;</span>],<span class="stringliteral">&#39;uid_foreign IN (&#39;</span>.$sql.<span class="charliteral">&#39;)&#39;</span>);
<a name="l01687"></a>01687                 <span class="keywordflow">return</span> $this-&gt;tableName.<span class="stringliteral">&#39;.uid IN (&#39;</span>.$sql.<span class="charliteral">&#39;)&#39;</span>;
<a name="l01688"></a>01688         }
<a name="l01689"></a>01689 
<a name="l01693"></a><a class="code" href="classx4epibase.html#a0be69e688d81bfc2f7f2fe247c145976">01693</a>         function <a class="code" href="classx4epibase.html#a0be69e688d81bfc2f7f2fe247c145976">getPiVars</a>() {
<a name="l01694"></a>01694                 <span class="keywordflow">if</span> (is_array($_POST[$this-&gt;prefixId])) {
<a name="l01695"></a>01695                         <span class="keywordflow">foreach</span>($_POST[$this-&gt;prefixId] as $k=&gt;$v) {
<a name="l01696"></a>01696                                 $this-&gt;piVars[$k] = $v;
<a name="l01697"></a>01697                         }
<a name="l01698"></a>01698                 }
<a name="l01699"></a>01699                 <span class="keywordflow">if</span> (is_array($_GET[$this-&gt;prefixId])) {
<a name="l01700"></a>01700                         <span class="keywordflow">foreach</span>($_GET[$this-&gt;prefixId] as $k=&gt;$v) {
<a name="l01701"></a>01701                                 $this-&gt;piVars[$k] = $v;
<a name="l01702"></a>01702                         }
<a name="l01703"></a>01703                 }
<a name="l01704"></a>01704         }
<a name="l01705"></a>01705 
<a name="l01714"></a><a class="code" href="classx4epibase.html#aeed34ca9ad6f09134194281dcd7b64b3">01714</a>         function <a class="code" href="classx4epibase.html#aeed34ca9ad6f09134194281dcd7b64b3">getLanguageOverlay</a>() {
<a name="l01715"></a>01715                 <span class="keywordflow">if</span> ($GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;sys_language_uid &gt; 0) {
<a name="l01716"></a>01716                         global $TCA;
<a name="l01717"></a>01717                         t3lib_div::loadTCA($this-&gt;tableName);
<a name="l01718"></a>01718                         <span class="keywordflow">if</span> (isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;languageField&#39;</span>])) {
<a name="l01719"></a>01719                                 $fields = array();
<a name="l01720"></a>01720                                 <span class="keywordflow">foreach</span>($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;columns&#39;</span>] as $key =&gt; $col) {
<a name="l01721"></a>01721                                         <span class="keywordflow">if</span> (($col[<span class="stringliteral">&#39;l10n_mode&#39;</span>] != <span class="stringliteral">&#39;exclude&#39;</span>) &amp;&amp; ($key != <span class="stringliteral">&#39;uid&#39;</span>)) {
<a name="l01722"></a>01722                                                 $fields[]= $key;
<a name="l01723"></a>01723                                         }
<a name="l01724"></a>01724                                 }
<a name="l01725"></a>01725                                 <span class="keywordflow">if</span>(isset($TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;transOrigPointerField&#39;</span>])){
<a name="l01726"></a>01726                                         $translation = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECTgetRows(implode(<span class="charliteral">&#39;,&#39;</span>,$fields),$this-&gt;tableName,<span class="stringliteral">&#39;sys_language_uid = &#39;</span>.$GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;sys_language_uid.<span class="stringliteral">&#39; AND &#39;</span>.$TCA[$this-&gt;tableName][<span class="stringliteral">&#39;ctrl&#39;</span>][<span class="stringliteral">&#39;transOrigPointerField&#39;</span>].<span class="stringliteral">&#39; = &#39;</span>.$this-&gt;internal[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>].$this-&gt;cObj-&gt;enableFields($this-&gt;tableName));
<a name="l01727"></a>01727                                 } <span class="keywordflow">else</span> {
<a name="l01728"></a>01728                                         $translation = $GLOBALS[<span class="stringliteral">&#39;TYPO3_DB&#39;</span>]-&gt;exec_SELECTgetRows(implode(<span class="charliteral">&#39;,&#39;</span>,$fields),$this-&gt;tableName,<span class="stringliteral">&#39;sys_language_uid = &#39;</span>.$GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;sys_language_uid.<span class="stringliteral">&#39; AND l18n_parent = &#39;</span>.$this-&gt;internal[<span class="stringliteral">&#39;currentRow&#39;</span>][<span class="stringliteral">&#39;uid&#39;</span>].$this-&gt;cObj-&gt;enableFields($this-&gt;tableName));
<a name="l01729"></a>01729                                 }
<a name="l01730"></a>01730                                 $translation = $translation[0];
<a name="l01731"></a>01731 
<a name="l01732"></a>01732                                 <span class="keywordflow">if</span> (isset($translation[<span class="stringliteral">&#39;sys_language_uid&#39;</span>])) {
<a name="l01733"></a>01733                                         <span class="keywordflow">foreach</span>($fields as $key) {
<a name="l01734"></a>01734                                                 $this-&gt;<span class="keyword">internal</span>[<span class="stringliteral">&#39;currentRow&#39;</span>][$key] = $translation[$key];
<a name="l01735"></a>01735                                         }
<a name="l01736"></a>01736                                 }
<a name="l01737"></a>01737                         }
<a name="l01738"></a>01738                 }
<a name="l01739"></a>01739         }
<a name="l01740"></a>01740 
<a name="l01748"></a><a class="code" href="classx4epibase.html#ac67638bb7c843524b5e744caf95f78cd">01748</a>         function <a class="code" href="classx4epibase.html#ac67638bb7c843524b5e744caf95f78cd">addLanguageLabels</a>(&amp;$mArr,$keyWrap = <span class="stringliteral">&#39;###|###&#39;</span>) {
<a name="l01749"></a>01749                 <span class="keywordflow">foreach</span>($this-&gt;LOCAL_LANG[<span class="stringliteral">&#39;default&#39;</span>] as $key =&gt; $value) {
<a name="l01750"></a>01750                         <span class="keywordflow">if</span> (isset($this-&gt;LOCAL_LANG[$this-&gt;LLkey][$key])) {
<a name="l01751"></a>01751                                 $value = $this-&gt;LOCAL_LANG[$this-&gt;LLkey][$key];
<a name="l01752"></a>01752                         }
<a name="l01753"></a>01753                         $key = $this-&gt;cObj-&gt;wrap($key,$keyWrap);
<a name="l01754"></a>01754                         $mArr[$key] = $value;
<a name="l01755"></a>01755                 }
<a name="l01756"></a>01756         }
<a name="l01757"></a>01757         
<a name="l01763"></a><a class="code" href="classx4epibase.html#aa9c10ae58264d424062f3f3317b80cb3">01763</a>         function <a class="code" href="classx4epibase.html#aa9c10ae58264d424062f3f3317b80cb3">listByCategoryWhere</a>() {
<a name="l01764"></a>01764                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l01765"></a>01765         }
<a name="l01766"></a>01766         
<a name="l01771"></a><a class="code" href="classx4epibase.html#aa162758c4ffbf6a1322155b348897643">01771</a>         function <a class="code" href="classx4epibase.html#aa162758c4ffbf6a1322155b348897643">addPrototype</a>() {
<a name="l01772"></a>01772         $GLOBALS[<span class="stringliteral">&#39;TSFE&#39;</span>]-&gt;additionalHeaderData[$this-&gt;extKey].=<span class="stringliteral">&#39;</span>
<a name="l01773"></a>01773 <span class="stringliteral">                        &lt;script type=&quot;text/javascript&quot; src=&quot;typo3conf/ext/x4epibase/js/scriptaculous/prototype.js&quot;&gt;&lt;/script&gt;</span>
<a name="l01774"></a>01774 <span class="stringliteral">                        &lt;script type=&quot;text/javascript&quot; src=&quot;typo3conf/ext/x4epibase/js/scriptaculous/scriptaculous.js&quot;&gt;&lt;/script&gt;&#39;</span>;
<a name="l01775"></a>01775     }
<a name="l01776"></a>01776         
<a name="l01777"></a>01777 }
<a name="l01778"></a>01778 
<a name="l01779"></a>01779 <span class="keywordflow">if</span> (defined(<span class="stringliteral">&#39;TYPO3_MODE&#39;</span>) &amp;&amp; $TYPO3_CONF_VARS[TYPO3_MODE][<span class="stringliteral">&#39;XCLASS&#39;</span>][<span class="stringliteral">&#39;ext/x4epibase/class.x4epibase.php&#39;</span>])       {
<a name="l01780"></a>01780         include_once($TYPO3_CONF_VARS[TYPO3_MODE][<span class="stringliteral">&#39;XCLASS&#39;</span>][<span class="stringliteral">&#39;ext/x4epibase/class.x4epibase.php&#39;</span>]);
<a name="l01781"></a>01781 }
<a name="l01782"></a>01782 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Aug 11 2010 09:43:35 for 4eyes - Base Class by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
